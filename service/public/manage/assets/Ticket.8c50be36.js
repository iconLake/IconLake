import{d as H,u as R,r as Z,E as G,m as u,p as J,o as K,c as d,b as t,g as W,t as s,e as o,v as z,q as V,A as X,B as h,C,l as E,f as w,F as b,h as Q,a6 as t1,i as a1,k as c,a as e1,_ as n1}from"./index.c3ac6b9b.js";import{p as r}from"./project.3e053923.js";import{i as i1,t as v,O as s1,h as U}from"./cache.05004cf3.js";import{L as A}from"./Loading.7dd0339b.js";import{t as l1,I as o1}from"./Icon.baf4c0eb.js";import{d as c1}from"./dayjs.min.794c16f3.js";import"./@iconlake/client.0b258216.js";import"./extension.dbd15d4c.js";const u1={class:"ticket"},d1={class:"claim flex start"},r1=["title"],p1=["title"],f1={class:"info"},v1={class:"flex center"},y1={key:0,class:"list"},m1={class:"flex link-container"},k1={class:"rank"},_1=["onClick"],g1=["title","onClick"],h1={class:"m-left flex center"},w1=["onClick"],M1=["onClick"],D1={class:"list"},L1={class:"flex"},x1={class:"rank"},T1=["href"],z1={key:0,class:"iconfont icon-heart"},C1=H({__name:"Ticket",setup(E1){const{t:i}=R(),F=a1(),l=Z({code:"",quantity:0,days:1}),p=G().params.id,N=u([]),f=u([]),y=u(!1),m=u(!1),k=u(!1),_=u(1),$=u(),g=u(!1),q=J(()=>`${window.location.origin}/manage/user/tickets?pid=${p}&code=${l.code}`),M=n=>`${window.location.origin}/manage/user/tickets?tid=${n._id}&code=${n.code}`;function D(n){i1(n),v(i("copyDone"))}async function I(){if(m.value)return;m.value=!0;const n=await r.editTicket({projectId:p,code:"new"}).finally(()=>{m.value=!1});l.code=n.code}async function B(n){await r.info(p,"ticket").onUpdate(async e=>{!n&&(!e.ticket||!e.ticket.code)?(await I(),await B(!0)):e.ticket&&Object.assign(l,e.ticket)})}async function j(){await r.getTickets({projectId:p}).onUpdate(async n=>{N.value=n.tickets})}async function L(){await r.getEmptyTickets({projectId:p}).onUpdate(async n=>{f.value=n.tickets.map(e=>({...e,isDeleting:!1}))})}async function O(){y.value||(y.value=!0,await r.editTicket({projectId:p,code:l.code,quantity:Number(l.quantity),days:Number(l.days)}).finally(()=>{y.value=!1}),v(i("saveDone")))}async function S(){k.value||(k.value=!0,await r.createEmptyTicket({projectId:p,quantity:Number(l.quantity),days:Number(l.days)}).finally(()=>{k.value=!1}),v(i("saveDone")),await L())}async function Y(n){n.isDeleting||U(i("deleteConfirm"),async()=>{n.isDeleting=!0,await r.deleteEmptyTicket({_id:n._id}).finally(()=>{n.isDeleting=!1}),v(i("deleteDone")),f.value=f.value.filter(e=>e._id!==n._id)})}async function P(n){g.value=!0,_.value=10,U($.value,async()=>{g.value=!1,await r.increaseTicketQuantity({_id:n._id,quantity:Number(_.value)}),v(i("saveDone")),await L()},{cancel:()=>{g.value=!1}})}return K(()=>{Promise.all([B(),j(),L()]).finally(()=>{F.end()})}),(n,e)=>(c(),d(b,null,[t("div",u1,[t("div",d1,[e[5]||(e[5]=W('<div class="m-right" data-v-86777f42><svg viewBox="0 0 1115 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" data-v-86777f42><path d="M84.836796 530.002235a136.14898 136.14898 0 0 1 21.526408 20.52776 136.038019 136.038019 0 0 1-16.755091 191.51845 135.261293 135.261293 0 0 1-51.152958 26.741569l196.62265 234.460304 726.460775-609.618984-295.155898-351.745938z" fill="#F6EB73" data-v-86777f42></path><path d="M547.811633 357.457463m-66.385745 55.704253a86.660435 86.660435 0 1 0 132.771489-111.408507 86.660435 86.660435 0 1 0-132.771489 111.408507Z" fill="#ED7751" data-v-86777f42></path><path d="M536.003668 739.718267L229.640723 996.814588a20.083916 20.083916 0 0 1-28.29502-2.441139L4.723052 760.024105a20.083916 20.083916 0 0 1 9.986478-32.289611 114.955455 114.955455 0 0 0 43.60762-22.857938 116.065063 116.065063 0 0 0 14.424912-163.334391 116.508907 116.508907 0 0 0-18.419504-17.531817 20.083916 20.083916 0 0 1-0.665765-31.290963l70.127266-58.809258a20.083916 20.083916 0 0 1 25.853881 30.736159l-52.484488 44.384346q3.328826 3.439787 6.324769 7.101495a156.232896 156.232896 0 0 1-19.30719 219.480588 154.457522 154.457522 0 0 1-30.625199 20.083917l165.66457 197.399376 291.272267-244.1139a20.083916 20.083916 0 0 1 25.853881 30.736159zM956.101497 387.195604L605.243246 681.685736a20.083916 20.083916 0 1 1-25.853881-30.73616l335.545652-281.618672L645.633001 48.432087l-454.939541 381.59441a20.083916 20.083916 0 0 1-25.520999-30.514238L635.20268 4.713507a20.083916 20.083916 0 0 1 28.29502 2.441139l295.155897 351.745937a20.083916 20.083916 0 0 1-2.5521 28.295021z" fill="#4E3D3A" data-v-86777f42></path><path d="M399.521805 534.662591l-198.287063 166.441296a20.083916 20.083916 0 0 1-25.853881-30.736159l198.287063-166.441296A20.083916 20.083916 0 1 1 399.521805 534.662591zM577.059187 555.634195L284.899233 800.968664a20.083916 20.083916 0 1 1-25.853881-30.736159L551.316267 524.898035A20.083916 20.083916 0 1 1 577.059187 555.634195zM606.907659 126.770457a20.083916 20.083916 0 0 1-28.29502-2.441139l-22.192173-26.852529a20.083916 20.083916 0 1 1 30.73616-25.853882l22.192172 26.852529a20.083916 20.083916 0 0 1-2.441139 28.295021zM806.859136 365.114392a20.083916 20.083916 0 0 1-28.295021-2.441139l-50.043349-59.585984A20.083916 20.083916 0 1 1 759.367886 277.455309l50.04335 59.585984a20.083916 20.083916 0 0 1-2.5521 28.073099z m-99.864778-119.171968a20.083916 20.083916 0 0 1-28.29502-2.441139l-50.043349-59.585984a20.083916 20.083916 0 0 1 30.736159-25.853881l50.043349 59.585984a20.083916 20.083916 0 0 1-2.552099 28.29502zM879.427541 451.552904a20.083916 20.083916 0 0 1-28.295021-2.441139l-22.192172-26.852529a20.083916 20.083916 0 1 1 30.736159-25.853881l22.192173 26.852529a20.083916 20.083916 0 0 1-2.441139 28.29502zM606.574777 443.896605a117.174672 117.174672 0 1 1-150.573892-179.756599 20.083916 20.083916 0 1 1 25.853881 30.736159A77.006839 77.006839 0 1 0 523.243168 277.455309a20.083916 20.083916 0 0 1-4.216513-39.945911A117.174672 117.174672 0 0 1 606.574777 443.896605z" fill="#4E3D3A" data-v-86777f42></path><path d="M234.744923 527.893979a135.816097 135.816097 0 0 1-125.274815 208.606423l104.636094 287.499598L1105.232898 699.106591 948.223276 268.134597z" fill="#F6EB73" data-v-86777f42></path><path d="M729.02644 524.272238m-81.434171 29.639614a86.660435 86.660435 0 1 0 162.868342-59.279228 86.660435 86.660435 0 1 0-162.868342 59.279228Z" fill="#ED7751" data-v-86777f42></path><path d="M587.045665 879.307034L210.888337 1016.121779a20.083916 20.083916 0 0 1-25.74292-11.983774l-104.303212-287.499597a20.083916 20.083916 0 0 1 20.416799-26.852529 115.732181 115.732181 0 0 0 118.062359-155.345209 116.508907 116.508907 0 0 0-11.096087-22.192173 20.083916 20.083916 0 0 1 10.097439-29.626551l85.994669-31.290963A20.083916 20.083916 0 0 1 317.96557 488.28095l-64.3573 23.412743q1.886335 4.438435 3.550747 8.876869a156.232896 156.232896 0 0 1-93.318086 199.729554 154.457522 154.457522 0 0 1-35.618437 8.322065l88.102925 242.227565 356.961099-129.269406a20.083916 20.083916 0 0 1 13.759147 37.726694zM1102.347916 691.783174L671.930726 848.459914a20.083916 20.083916 0 1 1-13.759148-37.726694l411.664805-149.797166-143.361436-393.800105-557.800262 203.058381A20.083916 20.083916 0 0 1 355.13746 432.800518l576.996491-210.270836a20.083916 20.083916 0 0 1 25.74292 11.983773L1114.44265 665.818332a20.083916 20.083916 0 0 1-12.094734 25.964842z" fill="#4E3D3A" data-v-86777f42></path><path d="M528.680251 639.85349l-243.226214 88.768691a20.083916 20.083916 0 1 1-13.759147-37.726694l243.226213-88.768691a20.083916 20.083916 0 0 1 13.759148 37.726694zM688.685816 720.411077L330.060305 850.901053a20.083916 20.083916 0 0 1-13.759147-37.726694l358.625511-130.489976a20.083916 20.083916 0 1 1 13.759147 37.726694zM863.227254 327.60962a20.083916 20.083916 0 0 1-25.74292-11.983774l-11.983773-33.288259a20.083916 20.083916 0 1 1 37.726693-13.759147l11.983774 33.288259a20.083916 20.083916 0 0 1-11.983774 25.742921zM969.638723 619.880535a20.083916 20.083916 0 0 1-25.742921-11.983774l-26.630607-73.123209a20.083916 20.083916 0 1 1 37.726694-13.204343l26.630607 73.12321a20.083916 20.083916 0 0 1-11.983773 25.188116z m-53.150254-146.135458a20.083916 20.083916 0 0 1-25.74292-11.983773L864.114941 388.416173a20.083916 20.083916 0 0 1 37.726694-13.759147l26.630607 73.123209a20.083916 20.083916 0 0 1-11.983773 25.964842zM1008.253103 725.95912a20.083916 20.083916 0 0 1-25.74292-11.983773l-11.983773-33.288259a20.083916 20.083916 0 0 1 37.726693-13.759147l11.983774 33.288259a20.083916 20.083916 0 0 1-11.983774 25.74292zM754.596569 625.206656a117.174672 117.174672 0 1 1-80.113744-220.146353A20.083916 20.083916 0 1 1 688.020051 442.786996a77.006839 77.006839 0 1 0 44.384345-2.330178 20.083916 20.083916 0 0 1 9.764556-38.947263A117.174672 117.174672 0 0 1 754.596569 625.206656z" fill="#4E3D3A" data-v-86777f42></path></svg></div>',1)),t("div",null,[t("p",null,s(o(i)("claimTicketLink")),1),t("p",{class:"c-main pointer",onClick:e[1]||(e[1]=a=>D(q.value))},[z(s(q.value),1),t("i",{class:"iconfont icon-copy m-left",title:o(i)("copy")},null,8,r1),t("i",{class:V(["iconfont icon-sync m-left",{loading:m.value}]),title:o(i)("refreshTicketCode"),onClick:e[0]||(e[0]=X(a=>I(),["stop"]))},null,10,p1)])])]),t("div",f1,[t("p",null,s(o(i)("ticketQuantity")),1),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>l.quantity=a),type:"number",class:"input",min:"0",max:"999999999"},null,512),[[C,l.quantity]]),t("p",null,s(o(i)("ticketDays")),1),h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.days=a),type:"number",class:"input",min:"0",max:"999999999"},null,512),[[C,l.days]]),t("div",v1,[t("button",{type:"submit",class:"btn",onClick:S},[z(s(o(i)("createNoUserEmptyTicket"))+" ",1),k.value?(c(),E(A,{key:0})):w("",!0)]),t("button",{type:"submit",class:"btn",onClick:O},[z(s(o(i)("save"))+" ",1),y.value?(c(),E(A,{key:0})):w("",!0)])])]),f.value.length?(c(),d("div",y1,[(c(!0),d(b,null,Q(f.value,(a,x)=>(c(),d("div",{key:a._id,class:"item flex"},[t("div",m1,[t("span",k1,s(x+1)+".",1),t("span",{class:"link-content c-main pointer",onClick:T=>D(M(a))},s(M(a)),9,_1),t("i",{class:"iconfont icon-copy m-left c-main pointer",title:o(i)("copy"),onClick:T=>D(M(a))},null,8,g1)]),t("div",h1,[t("span",null,s(a.quantity),1),e[6]||(e[6]=t("span",{class:"x"}," \xD7 ",-1)),t("span",null,s(a.days)+"D ",1),t("i",{class:"iconfont icon-plus m-left c-main pointer",onClick:T=>P(a)},null,8,w1),a.isDeleting?(c(),E(A,{key:1,class:"m-left c-danger"})):(c(),d("i",{key:0,class:"iconfont icon-delete m-left c-danger pointer",onClick:T=>Y(a)},null,8,M1))])]))),128))])):w("",!0),t("div",D1,[(c(!0),d(b,null,Q(N.value,(a,x)=>(c(),d("div",{key:a._id,class:"item flex"},[t("div",L1,[t("span",x1,s(x+1)+".",1),e1(o1,{info:o(l1)({img:{url:a.user.avatar}})},null,8,["info"]),t("a",{href:`${o(s1)}/exhibition/creator/${a.user._id}`,class:"name",target:"_blank"},s(a.user.name),9,T1)]),t("div",null,[a.like.isLike?(c(),d("i",z1)):w("",!0),t("span",{class:V({expired:+new Date(a.expired)<=Date.now()})},s(o(c1)(a.expired).format("YYYY/MM/DD HH:mm")),3)])]))),128))])]),h(t("div",{ref_key:"increaseQuantityFm",ref:$,class:"increase-quantity"},[t("p",null,s(o(i)("increasedTicketQuantity")),1),h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),type:"number",class:"input",min:"-999999999",max:"999999999"},null,512),[[C,_.value]])],512),[[t1,g.value]])],64))}});const U1=n1(C1,[["__scopeId","data-v-86777f42"]]);export{U1 as default};
