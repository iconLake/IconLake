import{d as Q,v as N,n as m,G as ne,c as f,b as t,e as r,F as z,g as W,f as K,y as F,z as q,s as R,H as X,o as _,t as u,p as Y,j as Z,u as se,r as ie,I as te,a as D,w as O,h as le,D as de,J as ue,B as re,K as pe,L as fe}from"./index.fe65cb18.js";import{n as _e,t as T,o as ve,a as me,p as he,i as ge,b as oe,r as Ie,s as ye}from"./project.1cbad204.js";import{I as ae}from"./Icon.8fdd1bb7.js";import{_ as ee}from"./_plugin-vue_export-helper.cdc0426e.js";import{H as ke}from"./Header.7c49167f.js";import{U as be}from"./User.87967eb8.js";const xe=d=>(Y("data-v-38ab5d92"),d=d(),Z(),d),$e={class:"value"},we=["value"],Ce={class:"dropdown"},De=["onClick"],Se=xe(()=>t("i",{class:"iconfont icon-plus"},null,-1)),Ve=[Se],Be={key:1,class:"add-form"},Me=Q({__name:"Select",props:{options:null,modelValue:null,addable:{type:Boolean},placeholder:null},emits:["update:modelValue","change","add"],setup(d,{emit:p}){const $=d,e=N(()=>{const I=$.options.find(w=>w.value===$.modelValue);return I?I.label||I.value:$.placeholder||""}),c=m(!1),h=m(!1),g=m(""),V=m(),M=m();let b=!1;ne(c,I=>{I||(b=!1,h.value=!1)});const a=I=>{const w=$.modelValue!==I.value;c.value=!1,p("update:modelValue",I.value),w&&p("change",I)},y=()=>{c.value=!0,b=!1},E=()=>{setTimeout(()=>{b||(c.value=!1),b=!1},20)},S=()=>{h.value=!0,b=!0,X(()=>{M.value.focus()})},j=()=>{!g.value||(h.value=!1,p("add",g.value),g.value="",L())},L=()=>{!c.value&&V.value.focus()},G=()=>{c.value=!c.value,c.value&&V.value.focus()};return(I,w)=>(_(),f("div",{class:R(["select",{active:c.value}])},[t("div",$e,[t("input",{ref_key:"valueInputDom",ref:V,class:"text pointer flex start",value:r(e),type:"text",readonly:"",onFocus:y,onBlur:E},null,40,we),t("i",{class:"iconfont icon-back flex pointer",onClick:G})]),t("div",Ce,[(_(!0),f(z,null,W($.options,C=>(_(),f("div",{key:C.value,class:"option pointer",onClick:U=>a(C)},u(C.label||C.value),9,De))),128)),d.addable&&!h.value?(_(),f("div",{key:0,class:"add pointer",onClick:S},Ve)):K("",!0),h.value?(_(),f("div",Be,[F(t("input",{ref_key:"addInputDom",ref:M,"onUpdate:modelValue":w[0]||(w[0]=C=>g.value=C),type:"text",onSubmit:j},null,544),[[q,g.value]]),t("i",{class:R(["iconfont icon-checked flex pointer",{active:!!g.value}]),onClick:j},null,2)])):K("",!0)])],2))}});const Ge=ee(Me,[["__scopeId","data-v-38ab5d92"]]),Te=d=>(Y("data-v-45120792"),d=d(),Z(),d),Ae={class:"flex start"},Ee={class:"info grow"},je={class:"item"},Ue={class:"label"},ze={class:"value"},Fe={class:"item"},Re={class:"label"},Le={class:"value"},He={class:"item info-group"},Ne={class:"label"},Oe={class:"value"},We={class:"item info-tag"},qe={class:"label"},Ke=Te(()=>t("div",{class:"value"},null,-1)),Pe={class:"tags flex start"},Je=["onClick"],Qe={key:0,class:"tag flex"},Xe=Q({__name:"Detail",props:{projectId:null,info:null,top:null,left:null,isShow:{type:Boolean},groups:null,icons:null},emits:["update","addGroup"],setup(d,{expose:p,emit:$}){const e=d;ue(v=>({48533960:r(S),c21b8528:r(j),"4cd86c53":r(E)}));const{t:c}=se(),h=m(!1),g=m(document.body),V=m(document.createElement("input")),M=m(document.createElement("input")),b=m(document.createElement("input")),a=ie({name:"",code:"",groupId:"",tag:""}),y=m(!1),E=N(()=>e.isShow?1:0),S=N(()=>h.value?e.top:"-50rem"),j=N(()=>h.value?e.left:"-50rem"),L=N(()=>[{label:c("ungrouped"),value:""},...e.groups.map(v=>({label:v.name,value:v._id}))]);p({root:g}),te(()=>{a.name=e.info.name,a.code=e.info.code,a.groupId=e.info.groupId||"",a.tag="",y.value=!1}),te(()=>{e.isShow?h.value=!0:setTimeout(()=>{e.isShow||(h.value=!1)},100)});function G(v){({name:V.value,code:M.value})[v].focus()}function I(){y.value=!y.value,y.value&&X(()=>{b.value.focus()})}async function w(){!a.tag||(await _e(e.projectId,e.info._id,a.tag),T.success(c("saveDone")),e.info.tags.push(a.tag),a.tag="",y.value=!1)}async function C(v,i){await he(e.projectId,e.info._id,i),T.success(c("deleteDone")),e.info.tags.splice(v,1)}async function U(v){const i={};if(v==="code"&&e.icons.some(o=>o.code===a.code))return T(c("codeExists"));i[v]=a[v],await ve(e.projectId,e.info._id,i),T(c("saveDone")),$("update",i)}async function P(v){const i={_id:"",name:v,num:0,icons:[]},o=await me(e.projectId,i);i._id=o._id,T(c("saveDone")),$("addGroup",i)}return(v,i)=>{const o=le("router-link");return _(),f("div",{class:"detail",ref_key:"root",ref:g},[t("div",Ae,[t("div",null,[D(ae,{info:d.info},null,8,["info"]),D(o,{to:`/analyse/icon/${d.projectId}/${d.info._id}`,class:"count-use c-main"},{default:O(()=>{var n;return[de(u(r(c)("pageRefererCount"))+" "+u((n=d.info.analyse)==null?void 0:n.pageCount),1)]}),_:1},8,["to"])]),t("div",Ee,[t("div",je,[t("div",Ue,u(r(c)("name")),1),t("div",ze,[F(t("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=n=>a.name=n),ref_key:"nameInputDom",ref:V,onChange:i[1]||(i[1]=n=>U("name"))},null,544),[[q,a.name]]),t("i",{class:"iconfont icon-edit pointer",onClick:i[2]||(i[2]=n=>G("name"))})])]),t("div",Fe,[t("div",Re,u(r(c)("code")),1),t("div",Le,[F(t("input",{type:"text","onUpdate:modelValue":i[3]||(i[3]=n=>a.code=n),ref_key:"codeInputDom",ref:M,onChange:i[4]||(i[4]=n=>U("code"))},null,544),[[q,a.code]]),t("i",{class:"iconfont icon-edit pointer",onClick:i[5]||(i[5]=n=>G("code"))})])]),t("div",He,[t("div",Ne,u(r(c)("group")),1),t("div",Oe,[D(Ge,{options:r(L),addable:!0,placeholder:r(c)("ungrouped"),modelValue:a.groupId,"onUpdate:modelValue":i[6]||(i[6]=n=>a.groupId=n),onChange:i[7]||(i[7]=n=>U("groupId")),onAdd:P},null,8,["options","placeholder","modelValue"])])]),t("div",We,[t("div",qe,u(r(c)("tag")),1),Ke,t("i",{class:R(["iconfont icon-add-circle pointer",{"icon-add-circle":!y.value,"icon-remove-circle":y.value}]),onClick:I},null,2)]),t("div",Pe,[(_(!0),f(z,null,W(d.info.tags,(n,s)=>(_(),f("div",{class:"tag flex",key:n},[t("span",null,u(n),1),t("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:l=>C(s,n)},null,8,Je)]))),128)),y.value?(_(),f("div",Qe,[F(t("input",{type:"text",maxlength:"8","onUpdate:modelValue":i[8]||(i[8]=n=>a.tag=n),ref_key:"tagInputDom",ref:b},null,512),[[q,a.tag]]),t("i",{class:R(["iconfont icon-checked pointer tag-add",{active:a.tag}]),onClick:w},null,2)])):K("",!0)])])])],512)}}});const Ye=ee(Xe,[["__scopeId","data-v-45120792"]]),A=d=>(Y("data-v-46783588"),d=d(),Z(),d),Ze={class:"name"},et=A(()=>t("i",{class:"iconfont icon-setting-plain"},null,-1)),tt={class:"search flex center"},ot={class:"input"},nt=A(()=>t("i",{class:"iconfont icon-search"},null,-1)),st=["placeholder"],it={class:"operate flex"},lt=A(()=>t("i",{class:"iconfont icon-plus"},null,-1)),at=A(()=>t("i",{class:"iconfont icon-batch"},null,-1)),ct=A(()=>t("i",{class:"iconfont icon-code"},null,-1)),dt={key:0,class:"operate-batch"},ut=["disabled"],rt=A(()=>t("i",{class:"iconfont icon-delete"},null,-1)),pt=["disabled"],ft=A(()=>t("i",{class:"iconfont icon-group-open"},null,-1)),_t=["onClick"],vt=["title"],mt={class:"icons"},ht=["onMouseenter","onClick"],gt={class:"name"},It={class:"code"},yt={class:"label"},kt={value:""},bt=["value"],xt=Q({__name:"Index",setup(d){const{t:p}=se(),$=re(),e=ie({_id:$.params.id,name:"",icons:[],groups:[],groupMap:{},list:[],detail:{info:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),c=m();async function h(){const o=await ge(e._id,"name icons groups");e.name=o.name,o.groups instanceof Array&&(e.groups=o.groups.sort((n,s)=>s.num-n.num),o.groups.forEach(n=>{e.groupMap[n._id]=n})),o.icons instanceof Array&&(e.icons=o.icons.reverse(),o.icons.length>0&&(g(),X(I)))}function g(){const o=e.groups.map(s=>(s.icons=[],s)),n=[];e.icons.forEach(s=>{V(s)&&(s.groupId&&s.groupId in e.groupMap?e.groupMap[s.groupId].icons.push(s):n.push(s))}),n.length>0&&(o.length===0||o[0]._id?o.unshift({_id:"",name:"",num:o.length,icons:n}):o[0].icons=n),e.list=o.sort((s,l)=>l.num-s.num).filter(M)}function V(o){if(!e.keyword)return!0;const n=new RegExp(e.keyword,"i");return n.test(o.name)||n.test(o.code)}function M(o){return e.keyword?o.icons.length>0:!0}h();const b=m(),a=m(),y=m();let E=0,S=0;function j(o,n){if(!a.value)return;S&&clearTimeout(S);const s=n.target.getBoundingClientRect(),l=a.value.getBoundingClientRect(),k=s.top-l.top+s.height,x=s.left+E-l.right,H=s.left+(x>0?-x:0)-l.left;e.detail={info:o,top:`${k}px`,left:`${H}px`,isShow:!0}}function L(){S&&clearTimeout(S)}function G(){S=setTimeout(()=>{e.detail.isShow=!1},300)}function I(){if(!(!a.value||!b.value)&&typeof a.value.querySelector=="function"){const o=a.value.querySelector(".icon-item");if(o){const n=o.getBoundingClientRect().width*3/2;b.value.style.width=`${Math.floor((window.innerWidth-20)/n)*n}px`}}}pe(()=>{var o;E=((o=y.value)==null?void 0:o.root.getBoundingClientRect().width)||200});function w(o,n){if(!!e.isBatching){if(e.selectedIcons.has(o._id)){e.selectedIcons.delete(o._id);return}else e.selectedIcons.set(o._id,o);if(n.shiftKey&&e.selectedIcons.size>1){const s=Array.from(e.selectedIcons.values()),l=s[s.length-2],k=s[s.length-1];if(l.groupId===k.groupId){const x=(e.groupMap[l.groupId]||e.list[0]).icons,H=x.findIndex(B=>B._id===l._id),J=x.findIndex(B=>B._id===k._id);if(Math.abs(H-J)>1)for(let B=Math.min(H,J)+1,ce=Math.max(H,J);B<ce;++B)e.selectedIcons.set(x[B]._id,x[B])}}}}function C(o){if(!e.isBatching)return;const s=o.icons.every(l=>e.selectedIcons.has(l._id))?"delete":"set";o.icons.forEach(l=>{e.selectedIcons[s](l._id,l)})}async function U(){oe(p("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const o=[];e.selectedIcons.forEach(n=>{o.push(n._id)}),await Ie(e._id,o),e.selectedIcons.clear(),T(p("deleteDone")),h()})}async function P(){!c.value||oe(c.value,async()=>{const o=[];e.selectedIcons.forEach(n=>{o.push(n._id)}),await ye(e._id,o,e.batchGroupId),e.selectedIcons.clear(),T(p("batchGroupDone")),h()})}function v(o){Object.assign(e.detail.info,o),"groupId"in o&&g()}function i(o){e.groups.push(o),e.groupMap[o._id]=o,g()}return ne(()=>e.keyword,()=>{g()}),(o,n)=>{const s=le("router-link");return _(),f(z,null,[D(ke,{back:"/home"},{default:O(()=>[t("div",Ze,u(e.name),1),D(s,{to:`/project/${e._id}/setting`,class:"setting flex"},{default:O(()=>[t("span",null,u(r(p)("setting")),1),et]),_:1},8,["to"])]),_:1}),D(be),t("div",{class:"main",ref_key:"mainDom",ref:b},[t("div",tt,[t("div",ot,[nt,F(t("input",{type:"text",placeholder:r(p)("search"),"onUpdate:modelValue":n[0]||(n[0]=l=>e.keyword=l)},null,8,st),[[q,e.keyword]])])]),t("div",it,[D(s,{to:`/icons/${e._id}/create`,class:"operate-item flex"},{default:O(()=>[t("span",null,u(r(p)("createIcons")),1),lt]),_:1},8,["to"]),t("div",{class:"operate-item flex",onClick:n[1]||(n[1]=l=>e.isBatching=!e.isBatching)},[t("span",null,u(r(p)(e.isBatching?"cancelBatchOperation":"batchOperation")),1),at]),D(s,{to:`/icons/${e._id}/use`,class:"operate-item flex"},{default:O(()=>[t("span",null,u(r(p)("useCode")),1),ct]),_:1},8,["to"])]),e.isBatching?(_(),f("div",dt,[t("button",{class:"btn",onClick:U,disabled:e.selectedIcons.size===0},[t("span",null,u(r(p)("batchDelete")),1),rt],8,ut),t("button",{class:"btn",onClick:P,disabled:e.selectedIcons.size===0},[t("span",null,u(r(p)("batchGroup")),1),ft],8,pt)])):K("",!0),t("div",{class:"list",ref_key:"iconListDom",ref:a},[(_(!0),f(z,null,W(e.list,l=>(_(),f("div",{class:"group",key:l._id},[t("div",{class:R(["group-title flex",{pointer:e.isBatching}]),onClick:k=>C(l)},[t("span",null,u(l.name),1),e.isBatching?(_(),f("span",{key:0,class:"iconfont icon-select-all",title:r(p)("selectAll")},null,8,vt)):K("",!0)],10,_t),t("div",mt,[(_(!0),f(z,null,W(l.icons,k=>(_(),f("div",{class:R(["icon-item t-center",{selectable:e.isBatching,selected:e.selectedIcons.has(k._id)}]),key:k._id,onMouseenter:x=>j(k,x),onMouseleave:n[2]||(n[2]=x=>G()),onClick:x=>w(k,x)},[D(ae,{info:k},null,8,["info"]),t("div",gt,u(k.name),1),t("div",It,u(k.code),1)],42,ht))),128))])]))),128)),D(Ye,{ref_key:"detailDom",ref:y,"project-id":e._id,info:e.detail.info,top:e.detail.top,left:e.detail.left,"is-show":e.detail.isShow,groups:e.groups,icons:e.icons,onUpdate:v,onAddGroup:i,onMouseenter:L,onMouseleave:G},null,8,["project-id","info","top","left","is-show","groups","icons"])],512)],512),t("div",{class:"group-select",ref_key:"batchGroupFormDom",ref:c},[t("div",yt,u(r(p)("batchSetGroup",{n:e.selectedIcons.size})),1),F(t("select",{"onUpdate:modelValue":n[3]||(n[3]=l=>e.batchGroupId=l)},[t("option",kt,u(r(p)("ungrouped")),1),(_(!0),f(z,null,W(e.groups,l=>(_(),f("option",{key:l._id,value:l._id},u(l.name),9,bt))),128))],512),[[fe,e.batchGroupId]])],512)],64)}}});const Bt=ee(xt,[["__scopeId","data-v-46783588"]]);export{Bt as default};
