import{d as M,u as E,m as x,o as A,c,b as a,t as i,e as o,B as d,C as r,a as B,w as S,v as h,F,h as N,l as g,f as P,A as T,i as z,k as u,_ as $}from"./index.c3ac6b9b.js";import{u as b,t as _,U as O,e as R,f as Z}from"./cache.05004cf3.js";import"./base.1da06d96.js";import{E as j}from"./el-progress.4a229156.js";import{L as w}from"./Loading.7dd0339b.js";import{u as q}from"./user.237cd0b6.js";import"./@iconlake/client.0b258216.js";const G={key:0,class:"preview-cnt"},H=["src"],J={key:1,class:"upload-add flex center"},K={key:1,class:"iconfont icon-plus"},Q={class:"flex between"},W={class:"medias"},X={class:"flex center"},Y=["onUpdate:modelValue","placeholder"],ee=["onUpdate:modelValue","placeholder"],ae=["onClick"],te={class:"flex center"},se=["disabled"],le=M({__name:"Info",setup(ne){const{t:l}=E(),U=z(),{userInfo:m,getUserInfo:k,refreshUserInfo:I}=q(),e=x({_id:"",name:"",desc:"",avatar:"",medias:[],tokenExpire:new Date}),v=x(!1),p=x(!1);async function V(){var n;if(!(!e.value.name||p.value)){p.value=!0;try{await b.editInfo({name:e.value.name,desc:e.value.desc,avatar:e.value.avatar,medias:(n=e.value.medias)==null?void 0:n.filter(t=>t.content),sex:e.value.sex,birthday:e.value.birthday,location:e.value.location})}catch{p.value=!1;return}_(l("saveDone")),p.value=!1,I()}}async function C(n){var s;if(!n.raw||!/^image\//i.test((s=n.raw)==null?void 0:s.type)){_(l("pleaseSelectFile",{type:l("img")}));return}if(!n.size||n.size>O){_(l("fileSizeLimitExceeded"));return}if(!e.value._id)return;v.value=!0;const t=await b.uploadFile({_id:`${Date.now()}${R(n.name)}`,data:await n.raw.arrayBuffer(),dir:Z.AVATAR}).catch(()=>{_(l("fileUploadFailed"))});v.value=!1,t&&(e.value.avatar=t.url)}const L=()=>{e.value.medias||(e.value.medias=[]),e.value.medias.push({name:"",content:""})},D=n=>{e.value.medias.splice(n,1)};return A(async()=>{await k(),U.end(),e.value={...m,medias:!m.medias||m.medias.length===0?[{name:"",content:""}]:m.medias}}),(n,t)=>(u(),c("form",{class:"info",onSubmit:t[5]||(t[5]=T(()=>{},["prevent"]))},[a("p",null,i(o(l)("userName")),1),d(a("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.value.name=s),type:"text",class:"input",maxlength:"16"},null,512),[[r,e.value.name]]),a("p",null,i(o(l)("userDesc")),1),d(a("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>e.value.desc=s),rows:"16",class:"input",maxlength:"1024"},null,512),[[r,e.value.desc]]),a("p",null,i(o(l)("avatar")),1),B(o(j),{"show-file-list":!1,"auto-upload":!1,accept:"image/*",class:"upload-input",onChange:C},{default:S(()=>[e.value.avatar&&!v.value?(u(),c("div",G,[a("img",{src:e.value.avatar,class:"upload-preview"},null,8,H),t[6]||(t[6]=a("div",{class:"preview-mask flex center"},[a("i",{class:"iconfont icon-edit"})],-1))])):(u(),c("div",J,[v.value?(u(),g(w,{key:0})):(u(),c("i",K))]))]),_:1}),a("p",Q,[h(i(o(l)("userMedias"))+" ",1),a("button",{type:"button",class:"iconfont icon-plus btn-add",onClick:L})]),a("ul",W,[(u(!0),c(F,null,N(e.value.medias,(s,y)=>(u(),c("li",{key:y,class:"item"},[a("div",X,[d(a("input",{"onUpdate:modelValue":f=>s.name=f,type:"text",class:"input name",placeholder:o(l)("userMediaNamePlaceholder"),maxlength:"16"},null,8,Y),[[r,s.name]]),d(a("input",{"onUpdate:modelValue":f=>s.content=f,type:"text",class:"input",placeholder:o(l)("userMediaContentPlaceholder"),maxlength:"128"},null,8,ee),[[r,s.content]]),a("button",{type:"button",class:"btn-del iconfont icon-delete",onClick:f=>D(y)},null,8,ae)])]))),128))]),a("p",null,i(o(l)("userSex")),1),d(a("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.sex=s),type:"text",class:"input",maxlength:"8"},null,512),[[r,e.value.sex]]),a("p",null,i(o(l)("userBirthday")),1),d(a("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.birthday=s),type:"text",class:"input",maxlength:"32"},null,512),[[r,e.value.birthday]]),a("p",null,i(o(l)("userLocation")),1),d(a("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.location=s),type:"text",class:"input",maxlength:"64"},null,512),[[r,e.value.location]]),a("div",te,[a("button",{type:"submit",class:"btn",disabled:!e.value.name,onClick:V},[h(i(o(l)("save"))+" ",1),p.value?(u(),g(w,{key:0})):P("",!0)],8,se)])],32))}});const me=$(le,[["__scopeId","data-v-1be8546d"]]);export{me as default};
