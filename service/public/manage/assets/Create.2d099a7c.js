import{d as O,u as H,B as M,E as R,r as D,c as p,a as T,w as G,b as a,s as F,t as u,e as m,F as k,g as J,D as b,f as g,o as v,p as P,j as U}from"./index.163447f8.js";import{i as z,t as _,v as q}from"./project.56eb7712.js";import{H as K}from"./Header.bdb6d639.js";import{U as Q}from"./User.93eefbfc.js";import{_ as W}from"./_plugin-vue_export-helper.cdc0426e.js";const X=h=>(P("data-v-5100d794"),h=h(),U(),h),Y={class:"name"},Z={class:"tab flex"},ee={class:"wrap"},te={class:"icons flex start"},se=["viewBox","innerHTML"],oe=["title"],ne=["title"],ae={key:0,class:"upload flex center"},ce={for:"svg"},ie={key:1,class:"upload flex center"},re={for:"javascript"},le={key:2,class:"upload flex center m-top"},de={class:"flex center"},fe=["disabled"],pe=X(()=>a("div",{class:"footer"},null,-1)),ue=O({__name:"Create",setup(h){const{t:n}=H(),B=M(),S=R(),s=D({_id:B.params.id,name:"",activeTab:"svg",icons:[]}),w={};async function E(){const o=await z(s._id,"name icons");s.name=o.name,o.icons.forEach(e=>{w[e.code]=e})}E();function C(o){return s.activeTab===o?"active":""}function I(o){s.activeTab=o,s.icons.length=0,d.clear()}let d=new Map;function y(){const o=[];d.forEach((e,t)=>{var c;if(e.prefix&&e.id&&(e.code=(c=e.id)==null?void 0:c.substring(e.prefix.length)),w[e.code])return d.delete(t),_(n("codeExistsAndIconOut",{code:e.code}));o.push(e)}),s.icons=o}function A(o){const e=o.target.files;e&&e.length>0&&Array.from(e).forEach(t=>{if(t.type!=="image/svg+xml")return;const c=new FileReader;c.readAsText(t,"utf-8"),c.onload=()=>{try{const f=new DOMParser().parseFromString(c.result,"image/svg+xml"),l=t.name.substring(0,t.name.lastIndexOf("."));let r=f.documentElement.getAttribute("viewBox");if(!r){const x=f.documentElement.getAttribute("width"),j=f.documentElement.getAttribute("height");x&&j?r=`0 0 ${x} ${j}`:r=""}const L={code:l,name:l,svg:{viewBox:r,path:Array.from(f.documentElement.children).map(x=>x.outerHTML).join("")}};d.set(l,L),y()}catch(i){console.error(i),_.error(n("fileCouldNotBeParsed"))}},c.onerror=()=>{_.error(n("fileLoadFailed"))}})}function $(o){const e=o.target.files;if(e&&e.length>0){if(e[0].type!=="text/javascript")return _.error(n("pleaseSelectFile",{type:".js"}));const t=new FileReader;t.readAsText(e[0],"utf-8"),t.onload=()=>{const i=t.result.match(/<symbol.*?>.*?<\/symbol>/ig);i&&(i.forEach(f=>{const l=f.match(/^<symbol.*?id="(.*?)".*?viewBox="(.*?)">(.*?)<\/symbol>$/i);if(l){const r={id:l[1],code:l[1],svg:{viewBox:l[2],path:l[3]}};d.has(r.id)||d.set(r.id,{}),Object.assign(d.get(r.id),r)}}),y())},t.onerror=()=>{_.error(n("fileLoadFailed"))}}}function V(o){const e=o.target.files;if(e&&e.length>0){if(e[0].type!=="application/json")return _.error(n("pleaseSelectFile",{type:".json"}));const t=new FileReader;t.readAsText(e[0],"utf-8"),t.onload=()=>{const c=t.result;try{const i=JSON.parse(c),f=i.css_prefix_text;i.glyphs instanceof Array&&(i.glyphs.forEach(l=>{const r=`${f}${l.font_class}`;d.has(r)||d.set(r,{}),Object.assign(d.get(r),{name:l.name,prefix:f})}),y())}catch{_.error(n("fileCouldNotBeParsed"))}},t.onerror=()=>{_.error(n("fileLoadFailed"))}}}async function N(){await q(s._id,s.icons),_.success(n("saveDone")),S.replace(`/icons/${s._id}`)}return(o,e)=>(v(),p(k,null,[T(K,{back:`/icons/${s._id}`},{default:G(()=>[a("div",Y,u(s.name),1)]),_:1},8,["back"]),T(Q),a("div",Z,[a("div",{class:F(["item",C("svg")]),onClick:e[0]||(e[0]=t=>I("svg"))},u(m(n)("uploadSVG")),3),a("div",{class:F(["item",C("iconfont")]),onClick:e[1]||(e[1]=t=>I("iconfont"))},u(m(n)("importIconfont")),3)]),a("div",ee,[a("div",te,[(v(!0),p(k,null,J(s.icons,t=>{var c,i;return v(),p("div",{key:t.code,class:"item"},[(v(),p("svg",{viewBox:(c=t.svg)==null?void 0:c.viewBox,innerHTML:(i=t.svg)==null?void 0:i.path},null,8,se)),t.code?(v(),p("div",{key:0,class:"name",title:t.code},u(t.code),9,oe)):g("",!0),t.name&&t.code!==t.name?(v(),p("div",{key:1,class:"name",title:t.name},u(t.name),9,ne)):g("",!0)])}),128))]),s.activeTab==="svg"?(v(),p("div",ae,[a("label",ce,[b(u(m(n)("selectIconFile",{type:"SVG"}))+" ",1),a("input",{id:"svg",type:"file",onChange:A,accept:"image/svg+xml",multiple:""},null,32)])])):g("",!0),s.activeTab==="iconfont"?(v(),p("div",ie,[a("label",re,[b(u(m(n)("selectIconFile",{type:"iconfont.js"}))+" ",1),a("input",{id:"javascript",type:"file",onChange:$,accept:"text/javascript"},null,32)])])):g("",!0),s.activeTab==="iconfont"?(v(),p("div",le,[a("label",null,[b(u(m(n)("selectIconFile",{type:"iconfont.json"}))+" ",1),a("input",{type:"file",onChange:V,accept:"application/json"},null,32)])])):g("",!0),a("div",de,[a("button",{class:"btn danger",disabled:s.icons.length===0,onClick:N},u(m(n)("save")),9,fe)])]),pe],64))}});const xe=W(ue,[["__scopeId","data-v-5100d794"]]);export{xe as default};
