import{d as X,u as Y,v as q,n as v,r as Z,G as J,c as p,b as o,a as I,w as E,t as l,e as d,y as x,z as R,H as ee,F as D,g as U,s as K,f as P,I as te,h as oe,o as f,D as le,p as se,j as ne,J as de,B as ue,K as re,L as pe}from"./index.44bd5203.js";import{n as fe,t as C,o as _e,p as he,i as ge,b as Q,r as me,s as ve}from"./project.10559182.js";import{I as ie}from"./Icon.9e23dd9a.js";import{_ as ae}from"./_plugin-vue_export-helper.cdc0426e.js";import{H as Ie}from"./Header.90a91b31.js";import{U as ye}from"./User.839ab9a8.js";const be=u=>(se("data-v-33c72da4"),u=u(),ne(),u),ke={class:"flex start"},we={class:"info grow"},$e={class:"item"},xe={class:"label"},De={class:"value"},Ce={class:"item"},Be={class:"label"},Me={class:"value"},Se={class:"item info-group"},Te={class:"label"},Ve={class:"value"},Ge={value:""},je=["value"],Ee={class:"item info-tag"},Ue={class:"label"},Ae=be(()=>o("div",{class:"value"},null,-1)),ze={class:"tags flex start"},Re=["onClick"],Fe={key:0,class:"tag flex"},Le=X({__name:"Detail",props:{projectId:null,info:null,top:null,left:null,isShow:{type:Boolean},groups:null,icons:null},emits:["update"],setup(u,{expose:r,emit:F}){const e=u;de(m=>({"699e8339":d(L),"6ba3caba":d(N),"0076e8bc":d(B)}));const{t:_}=Y(),B=q(()=>e.isShow?1:0),y=v(!1),L=q(()=>y.value?e.top:"-50rem"),N=q(()=>y.value?e.left:"-50rem"),M=v({}),w=v(),S=v(),T=v(),c=Z({name:"",code:"",groupId:"",tag:""}),b=v(!1);r({root:M}),J(()=>{c.name=e.info.name,c.code=e.info.code,c.groupId=e.info.groupId||"",c.tag="",b.value=!1}),J(()=>{e.isShow?y.value=!0:setTimeout(()=>{e.isShow||(y.value=!1)},100)});function A(m){({name:w.value,code:S.value})[m].focus()}function z(){b.value=!b.value,b.value&&te(()=>{T.value.focus()})}async function H(){!c.tag||(await fe(e.projectId,e.info._id,c.tag),C.success(_("saveDone")),e.info.tags.push(c.tag),c.tag="",b.value=!1)}async function O(m,a){await he(e.projectId,e.info._id,a),C.success(_("deleteDone")),e.info.tags.splice(m,1)}async function V(m){const a={};if(m==="code"&&e.icons.some(G=>G.code===c.code))return C(_("codeExists"));a[m]=c[m],await _e(e.projectId,e.info._id,a),C(_("saveDone")),F("update",a)}return(m,a)=>{const G=oe("router-link");return f(),p("div",{class:"detail",ref_key:"root",ref:M},[o("div",ke,[o("div",null,[I(ie,{info:u.info},null,8,["info"]),I(G,{to:`/analyse/icon/${u.projectId}/${u.info._id}`,class:"count-use c-main"},{default:E(()=>{var t;return[le(l(d(_)("pageRefererCount"))+" "+l((t=u.info.analyse)==null?void 0:t.pageCount),1)]}),_:1},8,["to"])]),o("div",we,[o("div",$e,[o("div",xe,l(d(_)("name")),1),o("div",De,[x(o("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>c.name=t),ref_key:"nameInputDom",ref:w,onChange:a[1]||(a[1]=t=>V("name"))},null,544),[[R,c.name]]),o("i",{class:"iconfont icon-edit pointer",onClick:a[2]||(a[2]=t=>A("name"))})])]),o("div",Ce,[o("div",Be,l(d(_)("code")),1),o("div",Me,[x(o("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>c.code=t),ref_key:"codeInputDom",ref:S,onChange:a[4]||(a[4]=t=>V("code"))},null,544),[[R,c.code]]),o("i",{class:"iconfont icon-edit pointer",onClick:a[5]||(a[5]=t=>A("code"))})])]),o("div",Se,[o("div",Te,l(d(_)("group")),1),o("div",Ve,[x(o("select",{onChange:a[6]||(a[6]=t=>V("groupId")),"onUpdate:modelValue":a[7]||(a[7]=t=>c.groupId=t)},[o("option",Ge,l(d(_)("ungrouped")),1),(f(!0),p(D,null,U(u.groups,t=>(f(),p("option",{key:t._id,value:t._id},l(t.name),9,je))),128))],544),[[ee,c.groupId]])])]),o("div",Ee,[o("div",Ue,l(d(_)("tag")),1),Ae,o("i",{class:"iconfont icon-add-circle pointer",onClick:z})]),o("div",ze,[(f(!0),p(D,null,U(u.info.tags,(t,s)=>(f(),p("div",{class:"tag flex",key:t},[o("span",null,l(t),1),o("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:n=>O(s,t)},null,8,Re)]))),128)),b.value?(f(),p("div",Fe,[x(o("input",{type:"text",maxlength:"8","onUpdate:modelValue":a[8]||(a[8]=t=>c.tag=t),ref_key:"tagInputDom",ref:T},null,512),[[R,c.tag]]),o("i",{class:K(["iconfont icon-checked pointer tag-add",{active:c.tag}]),onClick:H},null,2)])):P("",!0)])])])],512)}}});const Ne=ae(Le,[["__scopeId","data-v-33c72da4"]]),$=u=>(se("data-v-62bab286"),u=u(),ne(),u),He={class:"name"},Oe=$(()=>o("i",{class:"iconfont icon-setting-plain"},null,-1)),We={class:"search flex center"},qe={class:"input"},Ke=$(()=>o("i",{class:"iconfont icon-search"},null,-1)),Pe=["placeholder"],Je={class:"operate flex"},Qe=$(()=>o("i",{class:"iconfont icon-plus"},null,-1)),Xe=$(()=>o("i",{class:"iconfont icon-batch"},null,-1)),Ye=$(()=>o("i",{class:"iconfont icon-code"},null,-1)),Ze={key:0,class:"operate-batch"},et=["disabled"],tt=$(()=>o("i",{class:"iconfont icon-delete"},null,-1)),ot=["disabled"],st=$(()=>o("i",{class:"iconfont icon-group-open"},null,-1)),nt=["onClick"],it=["title"],at={class:"icons"},ct=["onMouseenter","onClick"],lt={class:"name"},dt={class:"code"},ut={class:"label"},rt={value:""},pt=["value"],ft=X({__name:"Index",setup(u){const{t:r}=Y(),F=ue(),e=Z({_id:F.params.id,name:"",icons:[],groups:[],groupMap:{},list:[],detail:{info:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),_=v({});async function B(){const t=await ge(e._id,"name icons groups");e.name=t.name,t.groups instanceof Array&&(e.groups=t.groups.sort((s,n)=>n.num-s.num),t.groups.forEach(s=>{e.groupMap[s._id]=s})),t.icons instanceof Array&&(e.icons=t.icons.reverse(),t.icons.length>0&&(y(),te(H)))}function y(){const t=e.groups.map(n=>(n.icons=[],n)),s=[];e.icons.forEach(n=>{L(n)&&(n.groupId&&n.groupId in e.groupMap?e.groupMap[n.groupId].icons.push(n):s.push(n))}),s.length>0&&(t.length===0||t[0]._id?t.unshift({_id:"",name:"",num:t.length,icons:s}):t[0].icons=s),e.list=t.sort((n,i)=>i.num-n.num).filter(N)}function L(t){if(!e.keyword)return!0;const s=new RegExp(e.keyword,"i");return s.test(t.name)||s.test(t.code)}function N(t){return e.keyword?t.icons.length>0:!0}B();const M=v({}),w=v({}),S=v({});let T=0,c=0;function b(t,s){c&&clearTimeout(c);const n=s.target.getBoundingClientRect(),i=w.value.getBoundingClientRect(),h=n.top-i.top+n.height,g=n.left+T-i.right,j=n.left+(g>0?-g:0)-i.left;e.detail={info:t,top:`${h}px`,left:`${j}px`,isShow:!0}}function A(){c&&clearTimeout(c)}function z(){c=setTimeout(()=>{e.detail.isShow=!1},300)}function H(){if(typeof w.value.querySelector=="function"){const t=w.value.querySelector(".icon-item");if(t){const s=t.getBoundingClientRect().width*3/2;M.value.style.width=`${Math.floor((window.innerWidth-20)/s)*s}px`}}}re(()=>{T=S.value.root.getBoundingClientRect().width});function O(t,s){if(!!e.isBatching){if(e.selectedIcons.has(t._id)){e.selectedIcons.delete(t._id);return}else e.selectedIcons.set(t._id,t);if(s.shiftKey&&e.selectedIcons.size>1){const n=Array.from(e.selectedIcons.values()),i=n[n.length-2],h=n[n.length-1];if(i.groupId===h.groupId){const g=(e.groupMap[i.groupId]||e.list[0]).icons,j=g.findIndex(k=>k._id===i._id),W=g.findIndex(k=>k._id===h._id);if(Math.abs(j-W)>1)for(let k=Math.min(j,W)+1,ce=Math.max(j,W);k<ce;++k)e.selectedIcons.set(g[k]._id,g[k])}}}}function V(t){if(!e.isBatching)return;const n=t.icons.every(i=>e.selectedIcons.has(i._id))?"delete":"set";t.icons.forEach(i=>{e.selectedIcons[n](i._id,i)})}async function m(){Q(r("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const t=[];e.selectedIcons.forEach(s=>{t.push(s._id)}),await me(e._id,t),e.selectedIcons.clear(),C(r("deleteDone")),B()})}async function a(){Q(_.value,async()=>{const t=[];e.selectedIcons.forEach(s=>{t.push(s._id)}),await ve(e._id,t,e.batchGroupId),e.selectedIcons.clear(),C(r("batchGroupDone")),B()})}function G(t){Object.assign(e.detail.info,t),"groupId"in t&&y()}return pe(()=>e.keyword,()=>{y()}),(t,s)=>{const n=oe("router-link");return f(),p(D,null,[I(Ie,{back:"/home"},{default:E(()=>[o("div",He,l(e.name),1),I(n,{to:`/project/${e._id}/setting`,class:"setting flex"},{default:E(()=>[o("span",null,l(d(r)("setting")),1),Oe]),_:1},8,["to"])]),_:1}),I(ye),o("div",{class:"main",ref_key:"mainDom",ref:M},[o("div",We,[o("div",qe,[Ke,x(o("input",{type:"text",placeholder:d(r)("search"),"onUpdate:modelValue":s[0]||(s[0]=i=>e.keyword=i)},null,8,Pe),[[R,e.keyword]])])]),o("div",Je,[I(n,{to:`/icons/${e._id}/create`,class:"operate-item flex"},{default:E(()=>[o("span",null,l(d(r)("createIcons")),1),Qe]),_:1},8,["to"]),o("div",{class:"operate-item flex",onClick:s[1]||(s[1]=i=>e.isBatching=!e.isBatching)},[o("span",null,l(d(r)(e.isBatching?"cancelBatchOperation":"batchOperation")),1),Xe]),I(n,{to:`/icons/${e._id}/use`,class:"operate-item flex"},{default:E(()=>[o("span",null,l(d(r)("useCode")),1),Ye]),_:1},8,["to"])]),e.isBatching?(f(),p("div",Ze,[o("button",{class:"btn",onClick:m,disabled:e.selectedIcons.size===0},[o("span",null,l(d(r)("batchDelete")),1),tt],8,et),o("button",{class:"btn",onClick:a,disabled:e.selectedIcons.size===0},[o("span",null,l(d(r)("batchGroup")),1),st],8,ot)])):P("",!0),o("div",{class:"list",ref_key:"iconListDom",ref:w},[(f(!0),p(D,null,U(e.list,i=>(f(),p("div",{class:"group",key:i._id},[o("div",{class:K(["group-title flex",{pointer:e.isBatching}]),onClick:h=>V(i)},[o("span",null,l(i.name),1),e.isBatching?(f(),p("span",{key:0,class:"iconfont icon-select-all",title:d(r)("selectAll")},null,8,it)):P("",!0)],10,nt),o("div",at,[(f(!0),p(D,null,U(i.icons,h=>(f(),p("div",{class:K(["icon-item t-center",{selectable:e.isBatching,selected:e.selectedIcons.has(h._id)}]),key:h._id,onMouseenter:g=>b(h,g),onMouseleave:s[2]||(s[2]=g=>z()),onClick:g=>O(h,g)},[I(ie,{info:h},null,8,["info"]),o("div",lt,l(h.name),1),o("div",dt,l(h.code),1)],42,ct))),128))])]))),128)),I(Ne,{ref_key:"detailDom",ref:S,"project-id":e._id,info:e.detail.info,top:e.detail.top,left:e.detail.left,"is-show":e.detail.isShow,groups:e.groups,icons:e.icons,onUpdate:G,onMouseenter:A,onMouseleave:z},null,8,["project-id","info","top","left","is-show","groups","icons"])],512)],512),o("div",{class:"group-select",ref_key:"batchGroupFormDom",ref:_},[o("div",ut,l(d(r)("batchSetGroup",{n:e.selectedIcons.size})),1),x(o("select",{"onUpdate:modelValue":s[3]||(s[3]=i=>e.batchGroupId=i)},[o("option",rt,l(d(r)("ungrouped")),1),(f(!0),p(D,null,U(e.groups,i=>(f(),p("option",{key:i._id,value:i._id},l(i.name),9,pt))),128))],512),[[ee,e.batchGroupId]])],512)],64)}}});const yt=ae(ft,[["__scopeId","data-v-62bab286"]]);export{yt as default};
