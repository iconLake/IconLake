import{B as S}from"./@iconlake/client.0b258216.js";import{d as C,u as D,E as F,m as d,o as I,c as L,b as t,t as r,e as l,B as f,C as v,v as c,l as A,f as h,A as T,F as E,i as O,k as g,_ as U}from"./index.c3ac6b9b.js";import{L as _}from"./Loading.7dd0339b.js";import{t as u}from"./cache.05004cf3.js";import{e as V,p as $}from"./project.3e053923.js";import"./extension.dbd15d4c.js";const j={class:"tip"},M=["placeholder"],N={class:"flex center btns"},P=["disabled"],z=["disabled"],R={class:"info help"},G={class:"tip"},H=C({__name:"Storage",setup(K){const k=O(),{t:o}=D(),b=F(),p=d(!1),i=d(!1),a=d({api:"",token:""}),m=b.params.id,y=async()=>{p.value=!0;try{await V(m,{"storage.api":a.value.api,"storage.token":a.value.token})}catch{p.value=!1;return}u(o("saveDone")),p.value=!1},B=async()=>{$.info(m,"storage").onUpdate(async s=>{s.storage&&(a.value=s.storage)})},w=()=>{if(i.value)return;i.value=!0;const s=new FormData;s.append("file",new File([S.from("R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==","base64")],"test.gif",{type:"image/gif"})),s.append("key",`test/${Date.now()}.gif`),fetch(a.value.api,{method:"POST",headers:{Authorization:`Bearer ${a.value.token}`},body:s}).then(e=>e.json()).then(e=>{if(e.key&&e.url){const n=new Image;n.src=e.url,n.onload=()=>{u(o("testSuccess"))},n.onerror=x=>{console.error(x),u(o("testFailed"))}}else console.error(e),u(o("testFailed"))}).catch(e=>{console.error(e),u(o("testFailed"))}).finally(()=>{i.value=!1})};return I(async()=>{await B(),k.end()}),(s,e)=>(g(),L(E,null,[t("form",{class:"info",onSubmit:e[2]||(e[2]=T(()=>{},["prevent"]))},[t("p",j,r(l(o)("uploadApiCustomizedDesc")),1),e[3]||(e[3]=t("p",null,"API",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.api=n),type:"text",class:"input",maxlength:"64",placeholder:`${l(o)("suchAs")}https://your-domain.com/upload`},null,8,M),[[v,a.value.api]]),e[4]||(e[4]=t("p",null,"Token",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.token=n),type:"text",class:"input",maxlength:"64"},null,512),[[v,a.value.token]]),t("div",N,[t("button",{type:"button",class:"btn",disabled:!a.value.api||!a.value.token||i.value,onClick:w},[c(r(l(o)("testAvailable"))+" ",1),i.value?(g(),A(_,{key:0})):h("",!0)],8,P),t("button",{type:"submit",class:"btn",disabled:!a.value.api||!a.value.token,onClick:y},[c(r(l(o)("save"))+" ",1),p.value?(g(),A(_,{key:0})):h("",!0)],8,z)])],32),t("div",R,[t("p",G,r(l(o)("howToBuildYourOwnUploadService")),1),t("p",null,[c(r(l(o)("setupUploadServiceWithOpensource"))+" ",1),e[5]||(e[5]=t("a",{href:"https://gitee.com/iconLake/dfs",target:"_blank"},[t("img",{src:"/imgs/gitee-logo.svg",height:"18",alt:"gitee"})],-1)),e[6]||(e[6]=t("a",{href:"https://github.com/iconLake/dfs",target:"_blank"},[t("img",{src:"/imgs/github-logo.svg",height:"18",alt:"gitee"})],-1))])])],64))}});const Z=U(H,[["__scopeId","data-v-d7e84aab"]]);export{Z as default};
