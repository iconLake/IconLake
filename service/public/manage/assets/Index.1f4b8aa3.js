import{d as H,J as ne,h as O,z,x as h,i as P,v as W,r as J,o as r,j as p,m as s,k as g,w as V,D as ie,t as l,l as n,p as L,B as M,C as A,I as K,F as b,n as B,q as Q,s as X,K as Y,E as ae,L as ce,M as le,y as de}from"./vendor.feadc916.js";import{n as ue,o as re,p as pe,i as fe,q as _e,r as he}from"./project.1b7086dc.js";import{I as Z}from"./Icon.d177cfdd.js";import{d as me,t as k,c as ee}from"./request.321932fc.js";import{_ as te}from"./plugin-vue_export-helper.5a098b48.js";import{H as ve}from"./Header.df72a625.js";import{U as ge}from"./User.db906533.js";import"./index.b9ae8af4.js";const oe=d=>(Q("data-v-7e6c995c"),d=d(),X(),d),Ie={class:"flex start"},ye={class:"info grow"},we={class:"item"},$e={key:0,class:"outline"},be={class:"label"},ke={class:"value"},xe={class:"item"},De={class:"label"},Ce={class:"value"},je={class:"item"},Me=oe(()=>s("div",{class:"label"},"Class",-1)),Be={class:"value"},Se={class:"item"},Te={class:"label"},Ve={class:"value"},Ge={class:"item"},Fe={class:"label"},Ue={class:"value"},Ee={value:""},Ne=["value"],Re={class:"item"},qe={class:"label"},ze=oe(()=>s("div",{class:"value"},null,-1)),Le={class:"tags flex start"},Ae=["onClick"],He={key:0,class:"tag flex"},Oe=H({props:{projectId:null,info:null,source:null,top:null,left:null,isShow:{type:Boolean},groups:null},emits:["update"],setup(d,{expose:_,emit:G}){const e=d;ne(v=>({e858ce6e:n(F),"22c891da":n(U),e9957368:n(D)}));const{t:f}=O(),D=z(()=>e.isShow?1:0),m=h(!1),F=z(()=>m.value?e.top:"-50rem"),U=z(()=>m.value?e.left:"-50rem"),C=h({}),I=h(),j=h(),$=h(!1),u=P({name:"",groupId:"",tag:""}),y=h(!1);_({root:C}),W(()=>{u.name=e.info.name,u.groupId=e.info.groupId||""}),W(()=>{e.isShow?m.value=!0:setTimeout(()=>{e.isShow||(m.value=!1)},100)});function E(){I.value.focus()}function S(){me(e.info.code),k(f("copyDone"))}function N(){y.value=!y.value,y.value&&Y(()=>{j.value.focus()})}async function R(){await ue(e.projectId,e.info._id,u.tag),k.success(f("saveDone")),e.info.tags.push(u.tag),u.tag="",y.value=!1}async function q(v,t){await re(e.projectId,e.info._id,t),k.success(f("deleteDone")),e.info.tags.splice(v,1)}async function T(v){const t={};t[v]=u[v],await pe(e.projectId,e.info._id,t),k(f("saveDone")),G("update",t)}return(v,t)=>{var a;const i=J("router-link");return r(),p("div",{class:"detail",ref:(o,c)=>{c.root=o,C.value=o}},[s("div",Ie,[s("div",null,[g(Z,{info:d.info,source:d.source},null,8,["info","source"]),g(i,{to:`/analyse/icon/${d.projectId}/${d.info._id}`,class:"count-use c-main"},{default:V(()=>{var o;return[ie(l(n(f)("pageRefererCount"))+" "+l((o=d.info.analyse)==null?void 0:o.pageCount),1)]}),_:1},8,["to"])]),s("div",ye,[s("div",we,[$.value?(r(),p("div",$e)):L("",!0),s("div",be,l(n(f)("name")),1),s("div",ke,[M(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>n(u).name=o),ref:(o,c)=>{c.nameInputDom=o,I.value=o},onFocus:t[1]||(t[1]=o=>$.value=!0),onBlur:t[2]||(t[2]=o=>$.value=!1),onChange:t[3]||(t[3]=o=>T("name"))},null,544),[[A,n(u).name]])]),s("i",{class:"iconfont icon-edit pointer",onClick:t[4]||(t[4]=o=>E())})]),s("div",xe,[s("div",De,l(n(f)("oriName")),1),s("div",Ce,l((a=d.info.originalData)==null?void 0:a.name),1)]),s("div",je,[Me,s("div",Be,l(d.info.code),1),s("i",{class:"iconfont icon-copy pointer",onClick:S})]),s("div",Se,[s("div",Te,l(n(f)("source")),1),s("div",Ve,l(d.source.name),1)]),s("div",Ge,[s("div",Fe,l(n(f)("group")),1),s("div",Ue,[M(s("select",{onChange:t[5]||(t[5]=o=>T("groupId")),"onUpdate:modelValue":t[6]||(t[6]=o=>n(u).groupId=o)},[s("option",Ee,l(n(f)("ungrouped")),1),(r(!0),p(b,null,B(d.groups,o=>(r(),p("option",{key:o._id,value:o._id},l(o.name),9,Ne))),128))],544),[[K,n(u).groupId]])])]),s("div",Re,[s("div",qe,l(n(f)("tag")),1),ze,s("i",{class:"iconfont icon-add-circle pointer",onClick:N})]),s("div",Le,[(r(!0),p(b,null,B(d.info.tags,(o,c)=>(r(),p("div",{class:"tag flex",key:o},[s("span",null,l(o),1),s("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:w=>q(c,o)},null,8,Ae)]))),128)),y.value?(r(),p("div",He,[M(s("input",{type:"text",maxlength:"8","onUpdate:modelValue":t[7]||(t[7]=o=>n(u).tag=o),ref:(o,c)=>{c.tagInputDom=o,j.value=o}},null,512),[[A,n(u).tag]]),s("i",{class:"iconfont icon-checked pointer tag-add",onClick:R})])):L("",!0)])])])],512)}}});var Pe=te(Oe,[["__scopeId","data-v-7e6c995c"]]);const x=d=>(Q("data-v-514829c9"),d=d(),X(),d),We={class:"name"},Je=x(()=>s("i",{class:"iconfont icon-setting-plain"},null,-1)),Ke={class:"search flex center"},Qe={class:"input"},Xe=x(()=>s("i",{class:"iconfont icon-search"},null,-1)),Ye=["placeholder"],Ze={class:"operate flex"},et=x(()=>s("i",{class:"iconfont icon-sync-cloud"},null,-1)),tt=x(()=>s("i",{class:"iconfont icon-batch"},null,-1)),ot={key:0,class:"operate-batch"},st=["disabled"],nt=x(()=>s("i",{class:"iconfont icon-delete"},null,-1)),it=["disabled"],at=x(()=>s("i",{class:"iconfont icon-group-open"},null,-1)),ct={class:"group-title"},lt={class:"icons"},dt=["onMouseenter","onClick"],ut={class:"name"},rt={class:"code"},pt={class:"label"},ft={value:""},_t=["value"],ht=H({setup(d){const{t:_}=O(),G=ae(),e=P({_id:G.params.id,name:"",icons:[],groups:[],groupMap:{},sources:[],sourceMap:{},list:[],detail:{info:{},source:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),f=h({});async function D(){const t=await fe(e._id,"name icons sources groups");if(e.name=t.name,t.icons instanceof Array&&(e.icons=t.icons),t.groups instanceof Array&&(e.groups=t.groups.sort((i,a)=>a.num-i.num),t.groups.forEach(i=>{e.groupMap[i._id]=i})),t.sources instanceof Array){e.sources=t.sources;const i=t.sources.map(async a=>{e.sourceMap[a._id]=a});await Promise.all(i)}t.icons.length>0&&(m(),Y(N))}function m(){const t=e.groups.map(a=>(a.icons=[],a)),i=[];e.icons.forEach(a=>{F(a)&&(a.groupId&&a.groupId in e.groupMap?e.groupMap[a.groupId].icons.push(a):i.push(a))}),i.length>0&&(t.length===0||t[0]._id?t.unshift({_id:"",name:"",num:t.length,icons:i}):t[0].icons=i),e.list=t.sort((a,o)=>o.num-a.num).filter(U)}function F(t){if(!e.keyword)return!0;const i=new RegExp(e.keyword,"i");return i.test(t.name)||i.test(t.code)}function U(t){return e.keyword?t.icons.length>0:!0}D();const C=h({}),I=h({}),j=h({});let $=0,u=0;function y(t,i){u&&clearTimeout(u);const a=i.target.getBoundingClientRect(),o=I.value.getBoundingClientRect(),c=a.top-o.top+a.height,w=a.left+$-o.right,se=a.left+(w>0?-w:0)-o.left;e.detail={info:t,source:e.sourceMap[t.sourceId],top:`${c}px`,left:`${se}px`,isShow:!0}}function E(){u&&clearTimeout(u)}function S(){u=setTimeout(()=>{e.detail.isShow=!1},300)}function N(){if(typeof I.value.querySelector=="function"){const t=I.value.querySelector(".icon-item");if(t){const i=t.getBoundingClientRect().width*3/2;C.value.style.width=`${Math.floor(window.innerWidth/i)*i}px`}}}ce(()=>{$=j.value.root.getBoundingClientRect().width});function R(t){!e.isBatching||(e.selectedIcons.has(t._id)?e.selectedIcons.delete(t._id):e.selectedIcons.set(t._id,t))}async function q(){ee(_("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const t=[];e.selectedIcons.forEach(i=>{t.push(i._id)}),await _e(e._id,t),e.selectedIcons.clear(),k(_("deleteDone")),D()})}async function T(){ee(f.value,async()=>{const t=[];e.selectedIcons.forEach(i=>{t.push(i._id)}),await he(e._id,t,e.batchGroupId),e.selectedIcons.clear(),k(_("batchGroupDone")),D()})}function v(t){Object.assign(e.detail.info,t),"groupId"in t&&m()}return le(()=>e.keyword,()=>{m()}),(t,i)=>{const a=J("router-link");return r(),p(b,null,[g(ve,{back:"/home"},{default:V(()=>[s("div",We,l(n(e).name),1),g(a,{to:`/project/${n(e)._id}/setting`,class:"setting flex"},{default:V(()=>[s("span",null,l(n(_)("setting")),1),Je]),_:1},8,["to"])]),_:1}),g(ge),s("div",{class:"main",ref:(o,c)=>{c.mainDom=o,C.value=o}},[s("div",Ke,[s("div",Qe,[Xe,M(s("input",{type:"text",placeholder:n(_)("search"),"onUpdate:modelValue":i[0]||(i[0]=o=>n(e).keyword=o)},null,8,Ye),[[A,n(e).keyword]])])]),s("div",Ze,[g(a,{to:`/project/${n(e)._id}/setting/source`,class:"operate-item flex"},{default:V(()=>[s("span",null,l(n(_)("sync")),1),et]),_:1},8,["to"]),s("div",{class:"operate-item flex",onClick:i[1]||(i[1]=o=>n(e).isBatching=!n(e).isBatching)},[s("span",null,l(n(_)(n(e).isBatching?"cancelBatchOperation":"batchOperation")),1),tt])]),n(e).isBatching?(r(),p("div",ot,[s("button",{class:"btn",onClick:q,disabled:n(e).selectedIcons.size===0},[s("span",null,l(n(_)("batchDelete")),1),nt],8,st),s("button",{class:"btn",onClick:T,disabled:n(e).selectedIcons.size===0},[s("span",null,l(n(_)("batchGroup")),1),at],8,it)])):L("",!0),s("div",{class:"list",ref:(o,c)=>{c.iconListDom=o,I.value=o}},[(r(!0),p(b,null,B(n(e).list,o=>(r(),p("div",{class:"group",key:o._id},[s("div",ct,l(o.name),1),s("div",lt,[(r(!0),p(b,null,B(o.icons,c=>(r(),p("div",{class:de(["icon-item t-center",{selectable:n(e).isBatching,selected:n(e).selectedIcons.has(c._id)}]),key:c._id,onMouseenter:w=>y(c,w),onMouseleave:i[2]||(i[2]=w=>S()),onClick:w=>R(c)},[g(Z,{info:c,source:n(e).sourceMap[c.sourceId]},null,8,["info","source"]),s("div",ut,l(c.name),1),s("div",rt,l(c.code),1)],42,dt))),128))])]))),128)),g(Pe,{ref:(o,c)=>{c.detailDom=o,j.value=o},"project-id":n(e)._id,info:n(e).detail.info,source:n(e).detail.source,top:n(e).detail.top,left:n(e).detail.left,"is-show":n(e).detail.isShow,groups:n(e).groups,onUpdate:v,onMouseenter:E,onMouseleave:S},null,8,["project-id","info","source","top","left","is-show","groups"])],512)],512),s("div",{class:"group-select",ref:(o,c)=>{c.batchGroupFormDom=o,f.value=o}},[s("div",pt,l(n(_)("batchSetGroup",{n:n(e).selectedIcons.size})),1),M(s("select",{"onUpdate:modelValue":i[3]||(i[3]=o=>n(e).batchGroupId=o)},[s("option",ft,l(n(_)("ungrouped")),1),(r(!0),p(b,null,B(n(e).groups,o=>(r(),p("option",{key:o._id,value:o._id},l(o.name),9,_t))),128))],512),[[K,n(e).batchGroupId]])],512)],64)}}});var kt=te(ht,[["__scopeId","data-v-514829c9"]]);export{kt as default};
