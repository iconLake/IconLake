import{d as B,u as O,m,r as k,o as $,c as w,b as t,t as d,e as i,q as z,a as M,w as N,v as V,l as v,f as h,F as P,i as H,k as f,_ as q}from"./index.c3ac6b9b.js";import"./base.1da06d96.js";import{E as R}from"./el-progress.4a229156.js";import{t as c,u as g,U as Z,f as T}from"./cache.05004cf3.js";import{L as C}from"./Loading.7dd0339b.js";import{A as J}from"./AIGenerate.46d453f8.js";import{u as K}from"./user.237cd0b6.js";import"./@iconlake/client.0b258216.js";import"./extension.dbd15d4c.js";import"./blockchain.62e14144.js";import"./index.9c1809da.js";const Q={class:"theme"},W={class:"title"},X={class:"flex start opt-type"},Y={class:"label"},ee={key:0},ae={class:"help flex start"},te={class:"input-item"},se={class:"label"},oe=["value","placeholder"],ie={class:"flex center"},ne=B({__name:"Theme",setup(le){const{t:s}=O(),U=H(),{userInfo:_,getUserInfo:E}=K(),n=m(!1),p=m(!1),l=k({creator:!1}),r=k({creator:""}),x=m(""),u=m(!1);$(()=>{F().finally(()=>{U.end()})});async function F(){var a,e,o;await E(),Object.assign(r,_.theme),n.value=!!((a=_.theme)!=null&&a.creator),x.value=(o=(e=_.blockchain)==null?void 0:e.id)!=null?o:""}function I(){n.value=!n.value,n.value||(r.creator="",y())}async function D(a,e){var b;if(!a.raw||!/^text\/javascript$/i.test((b=a.raw)==null?void 0:b.type)){c(s("pleaseSelectFile",{type:"js"}));return}if(!a.size||a.size>Z){c(s("fileSizeLimitExceeded"));return}l[e]=!0;const o=await g.uploadFile({_id:a.name,data:await a.raw.arrayBuffer(),dir:T.THEME}).catch(()=>{c(s("fileUploadFailed"))});l[e]=!1,o&&(r[e]=o.key)}async function L(a,e){if(!a)return;l[e]=!0;const o=await g.uploadFile({_id:`${e}-${Date.now()}.js`,data:a,dir:T.THEME}).catch(()=>{c(s("fileUploadFailed"))});l[e]=!1,o&&(r[e]=o.key)}async function A(a){await D(a,"creator")}async function y(){if(!u.value){if(l.creator){c(s("waitForUploadFinish"));return}u.value=!0;try{await g.editTheme(r)}catch{u.value=!1;return}c(s("saveDone")),u.value=!1}}function G(){p.value=!0}async function j(a){p.value=!1,await L(a,"creator")}async function S(){p.value=!1}return(a,e)=>(f(),w(P,null,[t("div",Q,[t("p",W,d(i(s)("exhibitionTheme")),1),t("div",X,[t("div",{class:z(["switch",{off:!n.value}]),onClick:I},null,2),t("div",Y,d(i(s)(n.value?"useDiyTheme":"useDefaultTheme")),1)]),n.value?(f(),w("div",ee,[t("p",ae,[t("span",null,d(i(s)("basedOnOpenSourceToDiyTheme")),1),e[1]||(e[1]=t("a",{target:"_blank",href:"https://gitee.com/iconLake/Theme",title:"Gitee"},[t("img",{src:"/imgs/gitee-logo.svg",alt:"gitee"})],-1)),e[2]||(e[2]=t("a",{target:"_blank",href:"https://github.com/iconLake/Theme",title:"Github"},[t("img",{src:"/imgs/github-logo.svg",alt:"github"})],-1))]),t("div",te,[t("p",se,d(i(s)("uploadExhibitionCreatorComponent")),1),M(i(R),{"show-file-list":!1,"auto-upload":!1,accept:"text/javascript",onChange:A},{default:N(()=>[t("input",{value:l.creator?i(s)("uploading"):r.creator,type:"text",readonly:"",placeholder:`${i(s)("selectFileAndExample")}creator-xxxxxxxx.js`,class:"upload-content"},null,8,oe),l.creator?(f(),v(C,{key:0})):h("",!0)]),_:1}),t("div",{class:"ai flex center",onClick:e[0]||(e[0]=o=>G())},e[3]||(e[3]=[t("i",{class:"iconfont icon-ai"},null,-1)]))]),t("div",ie,[t("button",{type:"submit",class:"btn",onClick:y},[V(d(i(s)("save"))+" ",1),u.value?(f(),v(C,{key:0})):h("",!0)])])])):h("",!0)]),p.value?(f(),v(J,{key:0,"on-finish":j,"on-cancel":S,type:"creator","creator-id":x.value},null,8,["creator-id"])):h("",!0)],64))}});const xe=q(ne,[["__scopeId","data-v-158471fb"]]);export{xe as default};
