import{d as N,u as L,B as O,E as H,r as M,c as f,a as w,w as R,b as n,s as I,t as p,e as m,F as j,g as D,D as y,f as g,o as u,p as G,j as J}from"./index.40cf615b.js";import{i as P,t as v,v as U}from"./project.df85cb82.js";import{H as z}from"./Header.3040b37b.js";import{U as q}from"./User.8b271f25.js";import{_ as K}from"./_plugin-vue_export-helper.cdc0426e.js";const Q=h=>(G("data-v-15452570"),h=h(),J(),h),W={class:"name"},X={class:"tab flex"},Y={class:"wrap"},Z={class:"icons flex start"},ee=["viewBox","innerHTML"],te=["title"],se=["title"],oe={key:0,class:"upload flex center"},ne={for:"svg"},ae={key:1,class:"upload flex center"},ce={for:"javascript"},ie={key:2,class:"upload flex center m-top"},re={class:"flex center"},le=["disabled"],de=Q(()=>n("div",{class:"footer"},null,-1)),fe=N({__name:"Create",setup(h){const{t:a}=L(),T=O(),F=H(),s=M({_id:T.params.id,name:"",activeTab:"svg",icons:[]}),k={};async function B(){const o=await P(s._id,"name icons");s.name=o.name,o.icons.forEach(t=>{k[t.code]=t})}B();function b(o){return s.activeTab===o?"active":""}function C(o){s.activeTab=o,s.icons.length=0,d.clear()}let d=new Map;function x(){const o=[];d.forEach(t=>{var e;t.prefix&&t.id&&(t.code=(e=t.id)==null?void 0:e.substring(t.prefix.length)),o.push(t)}),s.icons=o}function S(o){const t=o.target.files;t&&t.length>0&&Array.from(t).forEach(e=>{if(e.type!=="image/svg+xml")return;const r=new FileReader;r.readAsText(e,"utf-8"),r.onload=()=>{try{const _=new DOMParser().parseFromString(r.result,"image/svg+xml"),i=e.name.substring(0,e.name.lastIndexOf(".")),l={code:i,name:i,svg:{viewBox:_.documentElement.getAttribute("viewBox")||"",path:Array.from(_.documentElement.children).map(A=>A.outerHTML).join("")}};d.set(i,l),x()}catch(c){console.error(c),v.error(a("fileCouldNotBeParsed"))}},r.onerror=()=>{v.error(a("fileLoadFailed"))}})}function E(o){const t=o.target.files;if(t&&t.length>0){if(t[0].type!=="text/javascript")return v.error(a("pleaseSelectFile",{type:".js"}));const e=new FileReader;e.readAsText(t[0],"utf-8"),e.onload=()=>{const c=e.result.match(/<symbol.*?>.*?<\/symbol>/ig);c&&(c.forEach(_=>{const i=_.match(/^<symbol.*?id="(.*?)".*?viewBox="(.*?)">(.*?)<\/symbol>$/i);if(i){const l={id:i[1],code:i[1],svg:{viewBox:i[2],path:i[3]}};d.has(l.id)||d.set(l.id,{}),Object.assign(d.get(l.id),l)}}),x())},e.onerror=()=>{v.error(a("fileLoadFailed"))}}}function V(o){const t=o.target.files;if(t&&t.length>0){if(t[0].type!=="application/json")return v.error(a("pleaseSelectFile",{type:".json"}));const e=new FileReader;e.readAsText(t[0],"utf-8"),e.onload=()=>{const r=e.result;try{const c=JSON.parse(r),_=c.css_prefix_text;c.glyphs instanceof Array&&(c.glyphs.forEach(i=>{const l=`${_}${i.font_class}`;d.has(l)||d.set(l,{}),Object.assign(d.get(l),{name:i.name,prefix:_})}),x())}catch{v.error(a("fileCouldNotBeParsed"))}},e.onerror=()=>{v.error(a("fileLoadFailed"))}}}async function $(){await U(s._id,s.icons),v.success(a("saveDone")),F.replace(`/icons/${s._id}`)}return(o,t)=>(u(),f(j,null,[w(z,{back:`/icons/${s._id}`},{default:R(()=>[n("div",W,p(s.name),1)]),_:1},8,["back"]),w(q),n("div",X,[n("div",{class:I(["item",b("svg")]),onClick:t[0]||(t[0]=e=>C("svg"))},p(m(a)("uploadSVG")),3),n("div",{class:I(["item",b("iconfont")]),onClick:t[1]||(t[1]=e=>C("iconfont"))},p(m(a)("importIconfont")),3)]),n("div",Y,[n("div",Z,[(u(!0),f(j,null,D(s.icons,e=>{var r,c;return u(),f("div",{key:e.code,class:"item"},[(u(),f("svg",{viewBox:(r=e.svg)==null?void 0:r.viewBox,innerHTML:(c=e.svg)==null?void 0:c.path},null,8,ee)),e.code?(u(),f("div",{key:0,class:"name",title:e.code},p(e.code),9,te)):g("",!0),e.name&&e.code!==e.name?(u(),f("div",{key:1,class:"name",title:e.name},p(e.name),9,se)):g("",!0)])}),128))]),s.activeTab==="svg"?(u(),f("div",oe,[n("label",ne,[y(p(m(a)("selectIconFile",{type:"SVG"}))+" ",1),n("input",{id:"svg",type:"file",onChange:S,accept:"image/svg+xml",multiple:""},null,32)])])):g("",!0),s.activeTab==="iconfont"?(u(),f("div",ae,[n("label",ce,[y(p(m(a)("selectIconFile",{type:"iconfont.js"}))+" ",1),n("input",{id:"javascript",type:"file",onChange:E,accept:"text/javascript"},null,32)])])):g("",!0),s.activeTab==="iconfont"?(u(),f("div",ie,[n("label",null,[y(p(m(a)("selectIconFile",{type:"iconfont.json"}))+" ",1),n("input",{type:"file",onChange:V,accept:"application/json"},null,32)])])):g("",!0),n("div",re,[n("button",{class:"btn danger",disabled:s.icons.length===0,onClick:$},p(m(a)("save")),9,le)])]),de],64))}});const ge=K(fe,[["__scopeId","data-v-15452570"]]);export{ge as default};
