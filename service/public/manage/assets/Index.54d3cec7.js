import{d as N,G as se,h as q,y as H,v as g,i as O,H as W,r as P,o as f,j as _,m as o,k as v,w as M,E as ne,t as c,l as s,A as x,B as E,I as J,F as k,p as T,n as K,q as Q,s as X,J as Y,C as ie,K as ae,L as le,x as ce}from"./vendor.75eb7f42.js";import{n as de,t as V,o as ue,p as re,i as pe,b as Z,r as fe,s as _e}from"./project.27995b36.js";import{I as ee}from"./Icon.62b057e1.js";import{_ as te}from"./plugin-vue_export-helper.5a098b48.js";import{H as he}from"./Header.c4625430.js";import{U as me}from"./User.72ccd448.js";import"./index.c317b062.js";const ge=r=>(Q("data-v-67bf59df"),r=r(),X(),r),ve={class:"flex start"},Ie={class:"info grow"},be={class:"item"},we={class:"label"},ye={class:"value"},$e={class:"item"},xe={class:"label"},ke={class:"value"},Ce={class:"item info-group"},De={class:"label"},je={class:"value"},Be={value:""},Se=["value"],Me={class:"item info-tag"},Te={class:"label"},Ve=ge(()=>o("div",{class:"value"},null,-1)),Ge={class:"tags flex start"},Ue=["onClick"],Ee={key:0,class:"tag flex"},Re=N({props:{projectId:null,info:null,top:null,left:null,isShow:{type:Boolean},groups:null},emits:["update"],setup(r,{expose:p,emit:R}){const e=r;se(m=>({"678fd007":s(F),eb3330d6:s(L),"648a66ec":s(C)}));const{t:h}=q(),C=H(()=>e.isShow?1:0),I=g(!1),F=H(()=>I.value?e.top:"-50rem"),L=H(()=>I.value?e.left:"-50rem"),D=g({}),b=g(),j=g(),B=g(),d=O({name:"",code:"",groupId:"",tag:""}),w=g(!1);p({root:D}),W(()=>{d.name=e.info.name,d.code=e.info.code,d.groupId=e.info.groupId||""}),W(()=>{e.isShow?I.value=!0:setTimeout(()=>{e.isShow||(I.value=!1)},100)});function G(m){({name:b.value,code:j.value})[m].focus()}function U(){w.value=!w.value,w.value&&Y(()=>{B.value.focus()})}async function z(){await de(e.projectId,e.info._id,d.tag),V.success(h("saveDone")),e.info.tags.push(d.tag),d.tag="",w.value=!1}async function A(m,l){await ue(e.projectId,e.info._id,l),V.success(h("deleteDone")),e.info.tags.splice(m,1)}async function S(m){const l={};l[m]=d[m],await re(e.projectId,e.info._id,l),V(h("saveDone")),R("update",l)}return(m,l)=>{const n=P("router-link");return f(),_("div",{class:"detail",ref:(t,i)=>{i.root=t,D.value=t}},[o("div",ve,[o("div",null,[v(ee,{info:r.info},null,8,["info"]),v(n,{to:`/analyse/icon/${r.projectId}/${r.info._id}`,class:"count-use c-main"},{default:M(()=>{var t;return[ne(c(s(h)("pageRefererCount"))+" "+c((t=r.info.analyse)==null?void 0:t.pageCount),1)]}),_:1},8,["to"])]),o("div",Ie,[o("div",be,[o("div",we,c(s(h)("name")),1),o("div",ye,[x(o("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=t=>s(d).name=t),ref:(t,i)=>{i.nameInputDom=t,b.value=t},onChange:l[1]||(l[1]=t=>S("name"))},null,544),[[E,s(d).name]]),o("i",{class:"iconfont icon-edit pointer",onClick:l[2]||(l[2]=t=>G("name"))})])]),o("div",$e,[o("div",xe,c(s(h)("code")),1),o("div",ke,[x(o("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=t=>s(d).code=t),ref:(t,i)=>{i.codeInputDom=t,j.value=t},onChange:l[4]||(l[4]=t=>S("code"))},null,544),[[E,s(d).code]]),o("i",{class:"iconfont icon-edit pointer",onClick:l[5]||(l[5]=t=>G("code"))})])]),o("div",Ce,[o("div",De,c(s(h)("group")),1),o("div",je,[x(o("select",{onChange:l[6]||(l[6]=t=>S("groupId")),"onUpdate:modelValue":l[7]||(l[7]=t=>s(d).groupId=t)},[o("option",Be,c(s(h)("ungrouped")),1),(f(!0),_(k,null,T(r.groups,t=>(f(),_("option",{key:t._id,value:t._id},c(t.name),9,Se))),128))],544),[[J,s(d).groupId]])])]),o("div",Me,[o("div",Te,c(s(h)("tag")),1),Ve,o("i",{class:"iconfont icon-add-circle pointer",onClick:U})]),o("div",Ge,[(f(!0),_(k,null,T(r.info.tags,(t,i)=>(f(),_("div",{class:"tag flex",key:t},[o("span",null,c(t),1),o("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:a=>A(i,t)},null,8,Ue)]))),128)),w.value?(f(),_("div",Ee,[x(o("input",{type:"text",maxlength:"8","onUpdate:modelValue":l[8]||(l[8]=t=>s(d).tag=t),ref:(t,i)=>{i.tagInputDom=t,B.value=t}},null,512),[[E,s(d).tag]]),o("i",{class:"iconfont icon-checked pointer tag-add",onClick:z})])):K("",!0)])])])],512)}}});var Fe=te(Re,[["__scopeId","data-v-67bf59df"]]);const y=r=>(Q("data-v-2a20c762"),r=r(),X(),r),Le={class:"name"},ze=y(()=>o("i",{class:"iconfont icon-setting-plain"},null,-1)),Ae={class:"search flex center"},He={class:"input"},Ne=y(()=>o("i",{class:"iconfont icon-search"},null,-1)),qe=["placeholder"],Oe={class:"operate flex"},We=y(()=>o("i",{class:"iconfont icon-plus"},null,-1)),Pe=y(()=>o("i",{class:"iconfont icon-batch"},null,-1)),Je=y(()=>o("i",{class:"iconfont icon-code"},null,-1)),Ke={key:0,class:"operate-batch"},Qe=["disabled"],Xe=y(()=>o("i",{class:"iconfont icon-delete"},null,-1)),Ye=["disabled"],Ze=y(()=>o("i",{class:"iconfont icon-group-open"},null,-1)),et={class:"group-title"},tt={class:"icons"},ot=["onMouseenter","onClick"],st={class:"name"},nt={class:"code"},it={class:"label"},at={value:""},lt=["value"],ct=N({setup(r){const{t:p}=q(),R=ie(),e=O({_id:R.params.id,name:"",icons:[],groups:[],groupMap:{},list:[],detail:{info:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),h=g({});async function C(){const n=await pe(e._id,"name icons sources groups file");e.name=n.name,n.groups instanceof Array&&(e.groups=n.groups.sort((t,i)=>i.num-t.num),n.groups.forEach(t=>{e.groupMap[t._id]=t})),n.icons instanceof Array&&(e.icons=n.icons,n.icons.length>0&&(I(),Y(z)))}function I(){const n=e.groups.map(i=>(i.icons=[],i)),t=[];e.icons.forEach(i=>{F(i)&&(i.groupId&&i.groupId in e.groupMap?e.groupMap[i.groupId].icons.push(i):t.push(i))}),t.length>0&&(n.length===0||n[0]._id?n.unshift({_id:"",name:"",num:n.length,icons:t}):n[0].icons=t),e.list=n.sort((i,a)=>a.num-i.num).filter(L)}function F(n){if(!e.keyword)return!0;const t=new RegExp(e.keyword,"i");return t.test(n.name)||t.test(n.code)}function L(n){return e.keyword?n.icons.length>0:!0}C();const D=g({}),b=g({}),j=g({});let B=0,d=0;function w(n,t){d&&clearTimeout(d);const i=t.target.getBoundingClientRect(),a=b.value.getBoundingClientRect(),u=i.top-a.top+i.height,$=i.left+B-a.right,oe=i.left+($>0?-$:0)-a.left;e.detail={info:n,top:`${u}px`,left:`${oe}px`,isShow:!0}}function G(){d&&clearTimeout(d)}function U(){d=setTimeout(()=>{e.detail.isShow=!1},300)}function z(){if(typeof b.value.querySelector=="function"){const n=b.value.querySelector(".icon-item");if(n){const t=n.getBoundingClientRect().width*3/2;D.value.style.width=`${Math.floor((window.innerWidth-20)/t)*t}px`}}}ae(()=>{B=j.value.root.getBoundingClientRect().width});function A(n){!e.isBatching||(e.selectedIcons.has(n._id)?e.selectedIcons.delete(n._id):e.selectedIcons.set(n._id,n))}async function S(){Z(p("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const n=[];e.selectedIcons.forEach(t=>{n.push(t._id)}),await fe(e._id,n),e.selectedIcons.clear(),V(p("deleteDone")),C()})}async function m(){Z(h.value,async()=>{const n=[];e.selectedIcons.forEach(t=>{n.push(t._id)}),await _e(e._id,n,e.batchGroupId),e.selectedIcons.clear(),V(p("batchGroupDone")),C()})}function l(n){Object.assign(e.detail.info,n),"groupId"in n&&I()}return le(()=>e.keyword,()=>{I()}),(n,t)=>{const i=P("router-link");return f(),_(k,null,[v(he,{back:"/home"},{default:M(()=>[o("div",Le,c(s(e).name),1),v(i,{to:`/project/${s(e)._id}/setting`,class:"setting flex"},{default:M(()=>[o("span",null,c(s(p)("setting")),1),ze]),_:1},8,["to"])]),_:1}),v(me),o("div",{class:"main",ref:(a,u)=>{u.mainDom=a,D.value=a}},[o("div",Ae,[o("div",He,[Ne,x(o("input",{type:"text",placeholder:s(p)("search"),"onUpdate:modelValue":t[0]||(t[0]=a=>s(e).keyword=a)},null,8,qe),[[E,s(e).keyword]])])]),o("div",Oe,[v(i,{to:`/icons/${s(e)._id}/create`,class:"operate-item flex"},{default:M(()=>[o("span",null,c(s(p)("createIcons")),1),We]),_:1},8,["to"]),o("div",{class:"operate-item flex",onClick:t[1]||(t[1]=a=>s(e).isBatching=!s(e).isBatching)},[o("span",null,c(s(p)(s(e).isBatching?"cancelBatchOperation":"batchOperation")),1),Pe]),v(i,{to:`/icons/${s(e)._id}/use`,class:"operate-item flex"},{default:M(()=>[o("span",null,c(s(p)("useCode")),1),Je]),_:1},8,["to"])]),s(e).isBatching?(f(),_("div",Ke,[o("button",{class:"btn",onClick:S,disabled:s(e).selectedIcons.size===0},[o("span",null,c(s(p)("batchDelete")),1),Xe],8,Qe),o("button",{class:"btn",onClick:m,disabled:s(e).selectedIcons.size===0},[o("span",null,c(s(p)("batchGroup")),1),Ze],8,Ye)])):K("",!0),o("div",{class:"list",ref:(a,u)=>{u.iconListDom=a,b.value=a}},[(f(!0),_(k,null,T(s(e).list,a=>(f(),_("div",{class:"group",key:a._id},[o("div",et,c(a.name),1),o("div",tt,[(f(!0),_(k,null,T(a.icons,u=>(f(),_("div",{class:ce(["icon-item t-center",{selectable:s(e).isBatching,selected:s(e).selectedIcons.has(u._id)}]),key:u._id,onMouseenter:$=>w(u,$),onMouseleave:t[2]||(t[2]=$=>U()),onClick:$=>A(u)},[v(ee,{info:u},null,8,["info"]),o("div",st,c(u.name),1),o("div",nt,c(u.code),1)],42,ot))),128))])]))),128)),v(Fe,{ref:(a,u)=>{u.detailDom=a,j.value=a},"project-id":s(e)._id,info:s(e).detail.info,top:s(e).detail.top,left:s(e).detail.left,"is-show":s(e).detail.isShow,groups:s(e).groups,onUpdate:l,onMouseenter:G,onMouseleave:U},null,8,["project-id","info","top","left","is-show","groups"])],512)],512),o("div",{class:"group-select",ref:(a,u)=>{u.batchGroupFormDom=a,h.value=a}},[o("div",it,c(s(p)("batchSetGroup",{n:s(e).selectedIcons.size})),1),x(o("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>s(e).batchGroupId=a)},[o("option",at,c(s(p)("ungrouped")),1),(f(!0),_(k,null,T(s(e).groups,a=>(f(),_("option",{key:a._id,value:a._id},c(a.name),9,lt))),128))],512),[[J,s(e).batchGroupId]])],512)],64)}}});var mt=te(ct,[["__scopeId","data-v-2a20c762"]]);export{mt as default};
