import{d as X,v as F,n as g,G as se,c as v,b as o,e as u,F as N,g as P,f as K,y as W,z as q,s as R,H as Y,o as m,t as p,p as Z,j as ee,u as le,r as ie,I as oe,a as $,w as H,h as ae,D as re,J as pe,B as fe,K as _e}from"./index.163447f8.js";import{n as ve,t as A,o as me,a as he,p as ge,i as Ie,b as ne,r as ye,s as be}from"./project.56eb7712.js";import{I as ce}from"./Icon.130aad51.js";import{_ as te}from"./_plugin-vue_export-helper.cdc0426e.js";import{H as ke}from"./Header.bdb6d639.js";import{U as xe}from"./User.93eefbfc.js";const $e=d=>(Z("data-v-ce00e1cc"),d=d(),ee(),d),we={class:"value"},Ce=["value"],De={class:"dropdown"},Ve=["onClick"],Se=$e(()=>o("i",{class:"iconfont icon-plus"},null,-1)),Be=[Se],Ge={key:1,class:"add-form"},Me=X({__name:"Select",props:{options:null,modelValue:null,addable:{type:Boolean},placeholder:null,size:null},emits:["update:modelValue","change","add"],setup(d,{emit:r}){const w=d,e=F(()=>{const h=w.options.find(V=>V.value===w.modelValue);return h?h.label||h.value:w.placeholder||""}),i=g(!1),b=g(!1),I=g(""),x=g(),M=g();let C=!1;se(i,h=>{h||(C=!1,b.value=!1)});const a=h=>{const V=w.modelValue!==h.value;i.value=!1,r("update:modelValue",h.value),V&&r("change",h)},f=()=>{i.value=!0,C=!1},E=()=>{setTimeout(()=>{C||(i.value=!1),C=!1},20)},j=()=>{b.value=!0,C=!0,Y(()=>{M.value.focus()})},D=()=>{!I.value||(b.value=!1,r("add",I.value),I.value="",L())},L=()=>{!i.value&&x.value.focus()},z=()=>{i.value=!i.value,i.value&&x.value.focus()};return(h,V)=>(m(),v("div",{class:R(["select",{active:i.value,"size-default":d.size==="default"}])},[o("div",we,[o("input",{ref_key:"valueInputDom",ref:x,class:"text pointer flex start",value:u(e),type:"text",readonly:"",onFocus:f,onBlur:E},null,40,Ce),o("i",{class:"iconfont icon-back flex pointer",onClick:z})]),o("div",De,[(m(!0),v(N,null,P(w.options,S=>(m(),v("div",{key:S.value,class:"option pointer",onClick:U=>a(S)},p(S.label||S.value),9,Ve))),128)),d.addable&&!b.value?(m(),v("div",{key:0,class:"add pointer",onClick:j},Be)):K("",!0),b.value?(m(),v("div",Ge,[W(o("input",{ref_key:"addInputDom",ref:M,"onUpdate:modelValue":V[0]||(V[0]=S=>I.value=S),type:"text",onSubmit:D},null,544),[[q,I.value]]),o("i",{class:R(["iconfont icon-checked flex pointer",{active:!!I.value}]),onClick:D},null,2)])):K("",!0)])],2))}});const de=te(Me,[["__scopeId","data-v-ce00e1cc"]]),Ae=d=>(Z("data-v-45120792"),d=d(),ee(),d),Te={class:"flex start"},Ee={class:"info grow"},je={class:"item"},ze={class:"label"},Ue={class:"value"},Fe={class:"item"},Re={class:"label"},Le={class:"value"},Oe={class:"item info-group"},He={class:"label"},Ne={class:"value"},We={class:"item info-tag"},qe={class:"label"},Ke=Ae(()=>o("div",{class:"value"},null,-1)),Pe={class:"tags flex start"},Je=["onClick"],Qe={key:0,class:"tag flex"},Xe=X({__name:"Detail",props:{projectId:null,info:null,top:null,left:null,isShow:{type:Boolean},groups:null,icons:null},emits:["update","addGroup"],setup(d,{expose:r,emit:w}){const e=d;pe(_=>({48533960:u(j),c21b8528:u(D),"4cd86c53":u(E)}));const{t:i}=le(),b=g(!1),I=g(document.body),x=g(document.createElement("input")),M=g(document.createElement("input")),C=g(document.createElement("input")),a=ie({name:"",code:"",groupId:"",tag:""}),f=g(!1),E=F(()=>e.isShow?1:0),j=F(()=>b.value?e.top:"-50rem"),D=F(()=>b.value?e.left:"-50rem"),L=F(()=>[{label:i("ungrouped"),value:""},...e.groups.map(_=>({label:_.name,value:_._id}))]);r({root:I}),oe(()=>{a.name=e.info.name,a.code=e.info.code,a.groupId=e.info.groupId||"",a.tag="",f.value=!1}),oe(()=>{e.isShow?b.value=!0:setTimeout(()=>{e.isShow||(b.value=!1)},100)});function z(_){({name:x.value,code:M.value})[_].focus()}function h(){f.value=!f.value,f.value&&Y(()=>{C.value.focus()})}async function V(){!a.tag||(await ve(e.projectId,e.info._id,a.tag),A.success(i("saveDone")),e.info.tags.push(a.tag),a.tag="",f.value=!1)}async function S(_,s){await ge(e.projectId,e.info._id,s),A.success(i("deleteDone")),e.info.tags.splice(_,1)}async function U(_){const s={};if(_==="code"&&e.icons.some(B=>B.code===a.code))return A(i("codeExists"));s[_]=a[_],await me(e.projectId,e.info._id,s),A(i("saveDone")),w("update",s)}async function J(_){const s={_id:"",name:_,num:0,icons:[]},B=await he(e.projectId,s);s._id=B._id,A(i("saveDone")),w("addGroup",s)}return(_,s)=>{const B=ae("router-link");return m(),v("div",{class:"detail",ref_key:"root",ref:I},[o("div",Te,[o("div",null,[$(ce,{info:d.info},null,8,["info"]),$(B,{to:`/analyse/icon/${d.projectId}/${d.info._id}`,class:"count-use c-main"},{default:H(()=>{var t;return[re(p(u(i)("pageRefererCount"))+" "+p((t=d.info.analyse)==null?void 0:t.pageCount),1)]}),_:1},8,["to"])]),o("div",Ee,[o("div",je,[o("div",ze,p(u(i)("name")),1),o("div",Ue,[W(o("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=t=>a.name=t),ref_key:"nameInputDom",ref:x,onChange:s[1]||(s[1]=t=>U("name"))},null,544),[[q,a.name]]),o("i",{class:"iconfont icon-edit pointer",onClick:s[2]||(s[2]=t=>z("name"))})])]),o("div",Fe,[o("div",Re,p(u(i)("code")),1),o("div",Le,[W(o("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=t=>a.code=t),ref_key:"codeInputDom",ref:M,onChange:s[4]||(s[4]=t=>U("code"))},null,544),[[q,a.code]]),o("i",{class:"iconfont icon-edit pointer",onClick:s[5]||(s[5]=t=>z("code"))})])]),o("div",Oe,[o("div",He,p(u(i)("group")),1),o("div",Ne,[$(de,{options:u(L),addable:!0,placeholder:u(i)("ungrouped"),modelValue:a.groupId,"onUpdate:modelValue":s[6]||(s[6]=t=>a.groupId=t),onChange:s[7]||(s[7]=t=>U("groupId")),onAdd:J},null,8,["options","placeholder","modelValue"])])]),o("div",We,[o("div",qe,p(u(i)("tag")),1),Ke,o("i",{class:R(["iconfont icon-add-circle pointer",{"icon-add-circle":!f.value,"icon-remove-circle":f.value}]),onClick:h},null,2)]),o("div",Pe,[(m(!0),v(N,null,P(d.info.tags,(t,n)=>(m(),v("div",{class:"tag flex",key:t},[o("span",null,p(t),1),o("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:l=>S(n,t)},null,8,Je)]))),128)),f.value?(m(),v("div",Qe,[W(o("input",{type:"text",maxlength:"8","onUpdate:modelValue":s[8]||(s[8]=t=>a.tag=t),ref_key:"tagInputDom",ref:C},null,512),[[q,a.tag]]),o("i",{class:R(["iconfont icon-checked pointer tag-add",{active:a.tag}]),onClick:V},null,2)])):K("",!0)])])])],512)}}});const Ye=te(Xe,[["__scopeId","data-v-45120792"]]),T=d=>(Z("data-v-3538b2da"),d=d(),ee(),d),Ze={class:"name"},et=T(()=>o("i",{class:"iconfont icon-setting-plain"},null,-1)),tt={class:"search flex center"},ot={class:"input"},nt=T(()=>o("i",{class:"iconfont icon-search"},null,-1)),st=["placeholder"],lt={class:"operate flex"},it=T(()=>o("i",{class:"iconfont icon-plus"},null,-1)),at=T(()=>o("i",{class:"iconfont icon-batch"},null,-1)),ct=T(()=>o("i",{class:"iconfont icon-code"},null,-1)),dt={key:0,class:"operate-batch"},ut=["disabled"],rt=T(()=>o("i",{class:"iconfont icon-delete"},null,-1)),pt=["disabled"],ft=T(()=>o("i",{class:"iconfont icon-group-open"},null,-1)),_t=["onClick"],vt=["title"],mt={class:"icons"},ht=["onMouseenter","onClick"],gt={class:"name"},It={class:"code"},yt={class:"label"},bt=X({__name:"Index",setup(d){const{t:r}=le(),w=fe(),e=ie({_id:w.params.id,name:"",icons:[],groups:[],groupMap:{},list:[],detail:{info:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),i=g(),b=F(()=>[{label:r("ungrouped"),value:""},...e.groups.map(t=>({label:t.name,value:t._id}))]);async function I(){const t=await Ie(e._id,"name icons groups");e.name=t.name,t.groups instanceof Array&&(e.groups=t.groups.sort((n,l)=>l.num-n.num),t.groups.forEach(n=>{e.groupMap[n._id]=n})),t.icons instanceof Array&&(e.icons=t.icons.reverse(),x(),Y(V))}function x(){const t=e.groups.map(l=>(l.icons=[],l)),n=[];e.icons.forEach(l=>{M(l)&&(l.groupId&&l.groupId in e.groupMap?e.groupMap[l.groupId].icons.push(l):n.push(l))}),n.length>0&&(t.length===0||t[0]._id?t.unshift({_id:"",name:"",num:t.length,icons:n}):t[0].icons=n),e.list=t.sort((l,c)=>c.num-l.num).filter(C)}function M(t){if(!e.keyword)return!0;const n=new RegExp(e.keyword,"i");return n.test(t.name)||n.test(t.code)}function C(t){return e.keyword?t.icons.length>0:!0}I();const a=g(),f=g(),E=g();let j=0,D=0;function L(t,n){if(!f.value)return;D&&clearTimeout(D);const l=n.target.getBoundingClientRect(),c=f.value.getBoundingClientRect(),y=l.top-c.top+l.height,k=l.left+j-c.right,O=l.left+(k>0?-k:0)-c.left;e.detail={info:t,top:`${y}px`,left:`${O}px`,isShow:!0}}function z(){D&&clearTimeout(D)}function h(){D=setTimeout(()=>{e.detail.isShow=!1},300)}function V(){if(!(!f.value||!a.value)&&typeof f.value.querySelector=="function"){const t=f.value.querySelector(".icon-item");if(t){const n=t.getBoundingClientRect().width*3/2;a.value.style.width=`${Math.floor((window.innerWidth-20)/n)*n}px`}}}_e(()=>{var t;j=((t=E.value)==null?void 0:t.root.getBoundingClientRect().width)||200});function S(t,n){if(!!e.isBatching){if(e.selectedIcons.has(t._id)){e.selectedIcons.delete(t._id);return}else e.selectedIcons.set(t._id,t);if(n.shiftKey&&e.selectedIcons.size>1){const l=Array.from(e.selectedIcons.values()),c=l[l.length-2],y=l[l.length-1];if(c.groupId===y.groupId){const k=(e.groupMap[c.groupId]||e.list[0]).icons,O=k.findIndex(G=>G._id===c._id),Q=k.findIndex(G=>G._id===y._id);if(Math.abs(O-Q)>1)for(let G=Math.min(O,Q)+1,ue=Math.max(O,Q);G<ue;++G)e.selectedIcons.set(k[G]._id,k[G])}}}}function U(t){if(!e.isBatching)return;const l=t.icons.every(c=>e.selectedIcons.has(c._id))?"delete":"set";t.icons.forEach(c=>{e.selectedIcons[l](c._id,c)})}async function J(){ne(r("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const t=[];e.selectedIcons.forEach(n=>{t.push(n._id)}),await ye(e._id,t),e.selectedIcons.clear(),A(r("deleteDone")),I()})}async function _(){!i.value||ne(i.value,async()=>{const t=[];e.selectedIcons.forEach(n=>{t.push(n._id)}),await be(e._id,t,e.batchGroupId),e.selectedIcons.clear(),A(r("batchGroupDone")),I()})}function s(t){Object.assign(e.detail.info,t),"groupId"in t&&x()}function B(t){e.groups.push(t),e.groupMap[t._id]=t,x()}return se(()=>e.keyword,()=>{x()}),(t,n)=>{const l=ae("router-link");return m(),v(N,null,[$(ke,{back:"/home"},{default:H(()=>[o("div",Ze,p(e.name),1),$(l,{to:`/project/${e._id}/setting`,class:"setting flex"},{default:H(()=>[o("span",null,p(u(r)("setting")),1),et]),_:1},8,["to"])]),_:1}),$(xe),o("div",{class:"main",ref_key:"mainDom",ref:a},[o("div",tt,[o("div",ot,[nt,W(o("input",{type:"text",placeholder:u(r)("search"),"onUpdate:modelValue":n[0]||(n[0]=c=>e.keyword=c)},null,8,st),[[q,e.keyword]])])]),o("div",lt,[$(l,{to:`/icons/${e._id}/create`,class:"operate-item flex"},{default:H(()=>[o("span",null,p(u(r)("createIcons")),1),it]),_:1},8,["to"]),o("div",{class:"operate-item flex",onClick:n[1]||(n[1]=c=>e.isBatching=!e.isBatching)},[o("span",null,p(u(r)(e.isBatching?"cancelBatchOperation":"batchOperation")),1),at]),$(l,{to:`/icons/${e._id}/use`,class:"operate-item flex"},{default:H(()=>[o("span",null,p(u(r)("useCode")),1),ct]),_:1},8,["to"])]),e.isBatching?(m(),v("div",dt,[o("button",{class:"btn",onClick:J,disabled:e.selectedIcons.size===0},[o("span",null,p(u(r)("batchDelete")),1),rt],8,ut),o("button",{class:"btn",onClick:_,disabled:e.selectedIcons.size===0},[o("span",null,p(u(r)("batchGroup")),1),ft],8,pt)])):K("",!0),o("div",{class:"list",ref_key:"iconListDom",ref:f},[(m(!0),v(N,null,P(e.list,c=>(m(),v("div",{class:"group",key:c._id},[o("div",{class:R(["group-title flex",{pointer:e.isBatching}]),onClick:y=>U(c)},[o("span",null,p(c.name),1),e.isBatching?(m(),v("span",{key:0,class:"iconfont icon-select-all",title:u(r)("selectAll")},null,8,vt)):K("",!0)],10,_t),o("div",mt,[(m(!0),v(N,null,P(c.icons,y=>(m(),v("div",{class:R(["icon-item t-center",{selectable:e.isBatching,selected:e.selectedIcons.has(y._id)}]),key:y._id,onMouseenter:k=>L(y,k),onMouseleave:n[2]||(n[2]=k=>h()),onClick:k=>S(y,k)},[$(ce,{info:y},null,8,["info"]),o("div",gt,p(y.name),1),o("div",It,p(y.code),1)],42,ht))),128))])]))),128)),$(Ye,{ref_key:"detailDom",ref:E,"project-id":e._id,info:e.detail.info,top:e.detail.top,left:e.detail.left,"is-show":e.detail.isShow,groups:e.groups,icons:e.icons,onUpdate:s,onAddGroup:B,onMouseenter:z,onMouseleave:h},null,8,["project-id","info","top","left","is-show","groups","icons"])],512)],512),o("div",{class:"group-select",ref_key:"batchGroupFormDom",ref:i},[o("div",yt,p(u(r)("batchSetGroup",{n:e.selectedIcons.size})),1),$(de,{options:u(b),addable:!0,placeholder:u(r)("ungrouped"),size:"default",modelValue:e.batchGroupId,"onUpdate:modelValue":n[3]||(n[3]=c=>e.batchGroupId=c),onAdd:B},null,8,["options","placeholder","modelValue"])],512)],64)}}});const Vt=te(bt,[["__scopeId","data-v-3538b2da"]]);export{Vt as default};
