import{d as P,u as C,E as L,m as _,o as S,c as p,b as t,t as i,e as n,B as f,C as m,a as y,w as h,F as D,f as x,v as B,l as g,A as F,i as T,k as u,_ as j}from"./index.c3ac6b9b.js";import{p as M,e as A,u as N}from"./project.3e053923.js";import{P as w,t as v,U as O,e as R,f as $}from"./cache.05004cf3.js";import"./base.1da06d96.js";import{E as z}from"./el-switch.bfa116ff.js";import{E as G}from"./el-progress.4a229156.js";import{L as E}from"./Loading.7dd0339b.js";import{e as I}from"./event.47491da9.js";import"./@iconlake/client.0b258216.js";import"./extension.dbd15d4c.js";import"./index.2e271802.js";const J={key:0,class:"preview-cnt"},Y=["src"],Z={key:1,class:"upload-add flex center"},q={key:1,class:"iconfont icon-plus"},H={class:"flex center"},K=["disabled"],Q=P({__name:"Info",setup(W){const{t:s}=C(),b=T(),d=L().params.id,e=_({type:w.IMG,name:"",desc:"",cover:"",class:"",prefix:"",isPublic:!1}),c=_(!1),r=_(!1);async function U(){M.info(d,"type name desc cover class prefix").onUpdate(async o=>{e.value=o})}async function V(){if(!(!e.value||r.value)){r.value=!0;try{await A(d,e.value)}catch{r.value=!1;return}v(s("saveDone")),I.emit(I.EventType.ProjectInfoChange,{id:d}),r.value=!1}}async function k(o){var l;if(!o.raw||!/^image\//i.test((l=o.raw)==null?void 0:l.type)){v(s("pleaseSelectFile",{type:s("img")}));return}if(!o.size||o.size>O){v(s("fileSizeLimitExceeded"));return}c.value=!0;const a=await N({projectId:d,_id:`${Date.now()}${R(o.name)}`,data:await o.raw.arrayBuffer(),dir:$.COVER}).catch(()=>{v(s("fileUploadFailed"))});c.value=!1,a&&a.url&&(e.value.cover=a.url)}return S(()=>{U().finally(()=>{b.end()})}),(o,a)=>(u(),p("form",{class:"info",onSubmit:a[5]||(a[5]=F(()=>{},["prevent"]))},[t("p",null,i(n(s)("name")),1),f(t("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.name=l),type:"text",class:"input",maxlength:"64"},null,512),[[m,e.value.name]]),t("p",null,i(n(s)("desc")),1),f(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.desc=l),rows:"10",class:"input",maxlength:"300"},null,512),[[m,e.value.desc]]),t("p",null,i(n(s)("cover")),1),y(n(G),{"show-file-list":!1,"auto-upload":!1,accept:"image/*",class:"upload-input",onChange:k},{default:h(()=>[e.value.cover&&!c.value?(u(),p("div",J,[t("img",{src:e.value.cover,class:"upload-preview"},null,8,Y),a[6]||(a[6]=t("div",{class:"preview-mask flex center"},[t("i",{class:"iconfont icon-edit"})],-1))])):(u(),p("div",Z,[c.value?(u(),g(E,{key:0})):(u(),p("i",q))]))]),_:1}),e.value.type===n(w).SVG?(u(),p(D,{key:0},[t("p",null,i(n(s)("class")),1),f(t("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.class=l),type:"text",class:"input",maxlength:"15"},null,512),[[m,e.value.class]]),t("p",null,i(n(s)("prefix")),1),f(t("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.prefix=l),type:"text",class:"input",maxlength:"15"},null,512),[[m,e.value.prefix]])],64)):x("",!0),t("p",null,i(n(s)("isPublic")),1),y(n(z),{modelValue:e.value.isPublic,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.isPublic=l)},null,8,["modelValue"]),t("div",H,[t("button",{type:"submit",class:"btn",disabled:!e.value.name,onClick:V},[B(i(n(s)("save"))+" ",1),r.value?(u(),g(E,{key:0})):x("",!0)],8,K)])],32))}});const de=j(Q,[["__scopeId","data-v-b48f2f9d"]]);export{de as default};
