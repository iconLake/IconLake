import{d as P,G as ce,h as J,y as W,v,i as Q,H as X,r as Y,o as f,j as _,m as o,k as I,w as V,E as de,t as c,l as s,A as k,B as R,I as Z,F as C,p as G,n as K,q as ee,s as te,J as oe,C as ue,K as re,L as pe,x as se}from"./vendor.75eb7f42.js";import{n as fe,t as U,o as _e,p as he,i as ge,b as ne,r as me,s as ve}from"./project.7d7b5969.js";import{I as ie}from"./Icon.62b057e1.js";import{_ as ae}from"./plugin-vue_export-helper.5a098b48.js";import{H as Ie}from"./Header.c4625430.js";import{U as ye}from"./User.8145e7fc.js";import"./index.f8c94a2e.js";const be=r=>(ee("data-v-67bf59df"),r=r(),te(),r),we={class:"flex start"},xe={class:"info grow"},$e={class:"item"},ke={class:"label"},Ce={class:"value"},De={class:"item"},Be={class:"label"},Me={class:"value"},Se={class:"item info-group"},je={class:"label"},Te={class:"value"},Ve={value:""},Ge=["value"],Ue={class:"item info-tag"},Ae={class:"label"},Ee=be(()=>o("div",{class:"value"},null,-1)),Re={class:"tags flex start"},ze=["onClick"],Fe={key:0,class:"tag flex"},Le=P({props:{projectId:null,info:null,top:null,left:null,isShow:{type:Boolean},groups:null},emits:["update"],setup(r,{expose:p,emit:z}){const e=r;ce(m=>({"678fd007":s(F),eb3330d6:s(L),"648a66ec":s(D)}));const{t:h}=J(),D=W(()=>e.isShow?1:0),y=v(!1),F=W(()=>y.value?e.top:"-50rem"),L=W(()=>y.value?e.left:"-50rem"),B=v({}),w=v(),M=v(),S=v(),d=Q({name:"",code:"",groupId:"",tag:""}),x=v(!1);p({root:B}),X(()=>{d.name=e.info.name,d.code=e.info.code,d.groupId=e.info.groupId||""}),X(()=>{e.isShow?y.value=!0:setTimeout(()=>{e.isShow||(y.value=!1)},100)});function A(m){({name:w.value,code:M.value})[m].focus()}function E(){x.value=!x.value,x.value&&oe(()=>{S.value.focus()})}async function H(){await fe(e.projectId,e.info._id,d.tag),U.success(h("saveDone")),e.info.tags.push(d.tag),d.tag="",x.value=!1}async function N(m,l){await _e(e.projectId,e.info._id,l),U.success(h("deleteDone")),e.info.tags.splice(m,1)}async function j(m){const l={};l[m]=d[m],await he(e.projectId,e.info._id,l),U(h("saveDone")),z("update",l)}return(m,l)=>{const q=Y("router-link");return f(),_("div",{class:"detail",ref:(t,n)=>{n.root=t,B.value=t}},[o("div",we,[o("div",null,[I(ie,{info:r.info},null,8,["info"]),I(q,{to:`/analyse/icon/${r.projectId}/${r.info._id}`,class:"count-use c-main"},{default:V(()=>{var t;return[de(c(s(h)("pageRefererCount"))+" "+c((t=r.info.analyse)==null?void 0:t.pageCount),1)]}),_:1},8,["to"])]),o("div",xe,[o("div",$e,[o("div",ke,c(s(h)("name")),1),o("div",Ce,[k(o("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=t=>s(d).name=t),ref:(t,n)=>{n.nameInputDom=t,w.value=t},onChange:l[1]||(l[1]=t=>j("name"))},null,544),[[R,s(d).name]]),o("i",{class:"iconfont icon-edit pointer",onClick:l[2]||(l[2]=t=>A("name"))})])]),o("div",De,[o("div",Be,c(s(h)("code")),1),o("div",Me,[k(o("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=t=>s(d).code=t),ref:(t,n)=>{n.codeInputDom=t,M.value=t},onChange:l[4]||(l[4]=t=>j("code"))},null,544),[[R,s(d).code]]),o("i",{class:"iconfont icon-edit pointer",onClick:l[5]||(l[5]=t=>A("code"))})])]),o("div",Se,[o("div",je,c(s(h)("group")),1),o("div",Te,[k(o("select",{onChange:l[6]||(l[6]=t=>j("groupId")),"onUpdate:modelValue":l[7]||(l[7]=t=>s(d).groupId=t)},[o("option",Ve,c(s(h)("ungrouped")),1),(f(!0),_(C,null,G(r.groups,t=>(f(),_("option",{key:t._id,value:t._id},c(t.name),9,Ge))),128))],544),[[Z,s(d).groupId]])])]),o("div",Ue,[o("div",Ae,c(s(h)("tag")),1),Ee,o("i",{class:"iconfont icon-add-circle pointer",onClick:E})]),o("div",Re,[(f(!0),_(C,null,G(r.info.tags,(t,n)=>(f(),_("div",{class:"tag flex",key:t},[o("span",null,c(t),1),o("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:a=>N(n,t)},null,8,ze)]))),128)),x.value?(f(),_("div",Fe,[k(o("input",{type:"text",maxlength:"8","onUpdate:modelValue":l[8]||(l[8]=t=>s(d).tag=t),ref:(t,n)=>{n.tagInputDom=t,S.value=t}},null,512),[[R,s(d).tag]]),o("i",{class:"iconfont icon-checked pointer tag-add",onClick:H})])):K("",!0)])])])],512)}}});var He=ae(Le,[["__scopeId","data-v-67bf59df"]]);const $=r=>(ee("data-v-e519e414"),r=r(),te(),r),Ne={class:"name"},qe=$(()=>o("i",{class:"iconfont icon-setting-plain"},null,-1)),Oe={class:"search flex center"},We={class:"input"},Ke=$(()=>o("i",{class:"iconfont icon-search"},null,-1)),Pe=["placeholder"],Je={class:"operate flex"},Qe=$(()=>o("i",{class:"iconfont icon-plus"},null,-1)),Xe=$(()=>o("i",{class:"iconfont icon-batch"},null,-1)),Ye=$(()=>o("i",{class:"iconfont icon-code"},null,-1)),Ze={key:0,class:"operate-batch"},et=["disabled"],tt=$(()=>o("i",{class:"iconfont icon-delete"},null,-1)),ot=["disabled"],st=$(()=>o("i",{class:"iconfont icon-group-open"},null,-1)),nt=["onClick"],it=["title"],at={class:"icons"},lt=["onMouseenter","onClick"],ct={class:"name"},dt={class:"code"},ut={class:"label"},rt={value:""},pt=["value"],ft=P({setup(r){const{t:p}=J(),z=ue(),e=Q({_id:z.params.id,name:"",icons:[],groups:[],groupMap:{},list:[],detail:{info:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),h=v({});async function D(){const t=await ge(e._id,"name icons groups");e.name=t.name,t.groups instanceof Array&&(e.groups=t.groups.sort((n,a)=>a.num-n.num),t.groups.forEach(n=>{e.groupMap[n._id]=n})),t.icons instanceof Array&&(e.icons=t.icons.reverse(),t.icons.length>0&&(y(),oe(H)))}function y(){const t=e.groups.map(a=>(a.icons=[],a)),n=[];e.icons.forEach(a=>{F(a)&&(a.groupId&&a.groupId in e.groupMap?e.groupMap[a.groupId].icons.push(a):n.push(a))}),n.length>0&&(t.length===0||t[0]._id?t.unshift({_id:"",name:"",num:t.length,icons:n}):t[0].icons=n),e.list=t.sort((a,i)=>i.num-a.num).filter(L)}function F(t){if(!e.keyword)return!0;const n=new RegExp(e.keyword,"i");return n.test(t.name)||n.test(t.code)}function L(t){return e.keyword?t.icons.length>0:!0}D();const B=v({}),w=v({}),M=v({});let S=0,d=0;function x(t,n){d&&clearTimeout(d);const a=n.target.getBoundingClientRect(),i=w.value.getBoundingClientRect(),u=a.top-i.top+a.height,g=a.left+S-i.right,T=a.left+(g>0?-g:0)-i.left;e.detail={info:t,top:`${u}px`,left:`${T}px`,isShow:!0}}function A(){d&&clearTimeout(d)}function E(){d=setTimeout(()=>{e.detail.isShow=!1},300)}function H(){if(typeof w.value.querySelector=="function"){const t=w.value.querySelector(".icon-item");if(t){const n=t.getBoundingClientRect().width*3/2;B.value.style.width=`${Math.floor((window.innerWidth-20)/n)*n}px`}}}re(()=>{S=M.value.root.getBoundingClientRect().width});function N(t,n){if(!!e.isBatching){if(e.selectedIcons.has(t._id)){e.selectedIcons.delete(t._id);return}else e.selectedIcons.set(t._id,t);if(n.shiftKey&&e.selectedIcons.size>1){const a=Array.from(e.selectedIcons.values()),i=a[a.length-2],u=a[a.length-1];if(i.groupId===u.groupId){const g=(e.groupMap[i.groupId]||e.list[0]).icons,T=g.findIndex(b=>b._id===i._id),O=g.findIndex(b=>b._id===u._id);if(Math.abs(T-O)>1)for(let b=Math.min(T,O)+1,le=Math.max(T,O);b<le;++b)e.selectedIcons.set(g[b]._id,g[b])}}}}function j(t){if(!e.isBatching)return;const a=t.icons.every(i=>e.selectedIcons.has(i._id))?"delete":"set";t.icons.forEach(i=>{e.selectedIcons[a](i._id,i)})}async function m(){ne(p("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const t=[];e.selectedIcons.forEach(n=>{t.push(n._id)}),await me(e._id,t),e.selectedIcons.clear(),U(p("deleteDone")),D()})}async function l(){ne(h.value,async()=>{const t=[];e.selectedIcons.forEach(n=>{t.push(n._id)}),await ve(e._id,t,e.batchGroupId),e.selectedIcons.clear(),U(p("batchGroupDone")),D()})}function q(t){Object.assign(e.detail.info,t),"groupId"in t&&y()}return pe(()=>e.keyword,()=>{y()}),(t,n)=>{const a=Y("router-link");return f(),_(C,null,[I(Ie,{back:"/home"},{default:V(()=>[o("div",Ne,c(s(e).name),1),I(a,{to:`/project/${s(e)._id}/setting`,class:"setting flex"},{default:V(()=>[o("span",null,c(s(p)("setting")),1),qe]),_:1},8,["to"])]),_:1}),I(ye),o("div",{class:"main",ref:(i,u)=>{u.mainDom=i,B.value=i}},[o("div",Oe,[o("div",We,[Ke,k(o("input",{type:"text",placeholder:s(p)("search"),"onUpdate:modelValue":n[0]||(n[0]=i=>s(e).keyword=i)},null,8,Pe),[[R,s(e).keyword]])])]),o("div",Je,[I(a,{to:`/icons/${s(e)._id}/create`,class:"operate-item flex"},{default:V(()=>[o("span",null,c(s(p)("createIcons")),1),Qe]),_:1},8,["to"]),o("div",{class:"operate-item flex",onClick:n[1]||(n[1]=i=>s(e).isBatching=!s(e).isBatching)},[o("span",null,c(s(p)(s(e).isBatching?"cancelBatchOperation":"batchOperation")),1),Xe]),I(a,{to:`/icons/${s(e)._id}/use`,class:"operate-item flex"},{default:V(()=>[o("span",null,c(s(p)("useCode")),1),Ye]),_:1},8,["to"])]),s(e).isBatching?(f(),_("div",Ze,[o("button",{class:"btn",onClick:m,disabled:s(e).selectedIcons.size===0},[o("span",null,c(s(p)("batchDelete")),1),tt],8,et),o("button",{class:"btn",onClick:l,disabled:s(e).selectedIcons.size===0},[o("span",null,c(s(p)("batchGroup")),1),st],8,ot)])):K("",!0),o("div",{class:"list",ref:(i,u)=>{u.iconListDom=i,w.value=i}},[(f(!0),_(C,null,G(s(e).list,i=>(f(),_("div",{class:"group",key:i._id},[o("div",{class:se(["group-title flex",{pointer:s(e).isBatching}]),onClick:u=>j(i)},[o("span",null,c(i.name),1),s(e).isBatching?(f(),_("span",{key:0,class:"iconfont icon-select-all",title:s(p)("selectAll")},null,8,it)):K("",!0)],10,nt),o("div",at,[(f(!0),_(C,null,G(i.icons,u=>(f(),_("div",{class:se(["icon-item t-center",{selectable:s(e).isBatching,selected:s(e).selectedIcons.has(u._id)}]),key:u._id,onMouseenter:g=>x(u,g),onMouseleave:n[2]||(n[2]=g=>E()),onClick:g=>N(u,g)},[I(ie,{info:u},null,8,["info"]),o("div",ct,c(u.name),1),o("div",dt,c(u.code),1)],42,lt))),128))])]))),128)),I(He,{ref:(i,u)=>{u.detailDom=i,M.value=i},"project-id":s(e)._id,info:s(e).detail.info,top:s(e).detail.top,left:s(e).detail.left,"is-show":s(e).detail.isShow,groups:s(e).groups,onUpdate:q,onMouseenter:A,onMouseleave:E},null,8,["project-id","info","top","left","is-show","groups"])],512)],512),o("div",{class:"group-select",ref:(i,u)=>{u.batchGroupFormDom=i,h.value=i}},[o("div",ut,c(s(p)("batchSetGroup",{n:s(e).selectedIcons.size})),1),k(o("select",{"onUpdate:modelValue":n[3]||(n[3]=i=>s(e).batchGroupId=i)},[o("option",rt,c(s(p)("ungrouped")),1),(f(!0),_(C,null,G(s(e).groups,i=>(f(),_("option",{key:i._id,value:i._id},c(i.name),9,pt))),128))],512),[[Z,s(e).batchGroupId]])],512)],64)}}});var bt=ae(ft,[["__scopeId","data-v-e519e414"]]);export{bt as default};
