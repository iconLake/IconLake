let r=!1,s;const w="iconlakeRequest:",p="iconlakeResponse:",y=setInterval(()=>{a({type:"ping",ignoreReady:!0,timeout:200}).then(e=>{clearInterval(y),r=!0,s=e}).catch(console.error)},50);async function a({type:e,params:n,timeout:t=3e5,ignoreReady:i}){!r&&!i&&await new Promise(f=>{const c=setInterval(()=>{r&&(clearInterval(c),f(null))},100)});const d=`${Date.now()}:${Math.random().toString().slice(2)}`;return window.postMessage({type:w+e,id:d,params:n}),new Promise((f,c)=>{const m=setTimeout(()=>{window.removeEventListener("message",u),c(new Error("timeout"))},t),u=o=>{o.data.type===p+e&&o.data.id===d&&(clearTimeout(m),window.removeEventListener("message",u),o.data.error?c(o.data.error):f(o.data.response))};window.addEventListener("message",u)})}function v(e){return a({type:"search",params:e})}function h(e){return a({type:"detail",params:e})}function g(e){return a({type:"option",params:e})}var I=(e=>(e.SaveFiles="saveFiles",e.GetFiles="getFiles",e))(I||{});function l(e){return a({type:"storage",params:e})}l.getFile=async({key:e})=>{var t;const n=await l({method:"getFiles",params:{keys:[e]}});if(!n.files||((t=n.files)==null?void 0:t.length)===0)throw new Error("get file failed");return n.files[0]};l.saveFile=async({key:e,data:n})=>{var i;const t=await l({method:"saveFiles",params:{files:[{key:e,data:n}]}});if(!t.files||((i=t.files)==null?void 0:i.length)===0)throw new Error("upload file failed");return t.files[0]};async function E(){return await new Promise((e,n)=>{const t=setInterval(()=>{r&&(clearInterval(t),clearTimeout(i),e(null))},50),i=setTimeout(()=>{clearInterval(t),e(null)},1e3)}),{isReady:r,search:s==null?void 0:s.search,isDesktop:s==null?void 0:s.isDesktop,nodejs:s==null?void 0:s.nodejs}}function T(){return r}function F(e){if(r)e();else{const n=setInterval(()=>{r&&(clearInterval(n),e())},50)}}function x(e){return a({type:"buildTheme",params:e})}const k={search:v,detail:h,option:g,getExtensionInfo:E,storage:l,isReady:T,onReady:F,buildTheme:x};export{I as S,k as e,l as s};
