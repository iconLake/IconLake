import{d as X,u as Y,v as q,n as v,r as Z,G as J,c as p,b as o,a as I,w as G,t as c,e as d,y as x,z,H as ee,F as D,g as j,s as K,f as P,I as te,h as oe,o as f,D as ce,p as se,j as ne,J as de,B as ue,K as re,L as pe}from"./index.40cf615b.js";import{n as fe,t as U,o as _e,p as he,i as ge,b as Q,r as me,s as ve}from"./project.df85cb82.js";import{I as ie}from"./Icon.e29f29c1.js";import{_ as ae}from"./_plugin-vue_export-helper.cdc0426e.js";import{H as Ie}from"./Header.3040b37b.js";import{U as ye}from"./User.8b271f25.js";const ke=u=>(se("data-v-d3e94b0a"),u=u(),ne(),u),be={class:"flex start"},we={class:"info grow"},$e={class:"item"},xe={class:"label"},De={class:"value"},Ce={class:"item"},Be={class:"label"},Me={class:"value"},Se={class:"item info-group"},Te={class:"label"},Ve={class:"value"},Ge={value:""},je=["value"],Ue={class:"item info-tag"},Ae={class:"label"},Ee=ke(()=>o("div",{class:"value"},null,-1)),ze={class:"tags flex start"},Re=["onClick"],Fe={key:0,class:"tag flex"},Le=X({__name:"Detail",props:{projectId:null,info:null,top:null,left:null,isShow:{type:Boolean},groups:null},emits:["update"],setup(u,{expose:r,emit:R}){const e=u;de(m=>({"625875a0":d(F),"0ba1178c":d(L),"4291be33":d(C)}));const{t:h}=Y(),C=q(()=>e.isShow?1:0),y=v(!1),F=q(()=>y.value?e.top:"-50rem"),L=q(()=>y.value?e.left:"-50rem"),B=v({}),w=v(),M=v(),S=v(),l=Z({name:"",code:"",groupId:"",tag:""}),k=v(!1);r({root:B}),J(()=>{l.name=e.info.name,l.code=e.info.code,l.groupId=e.info.groupId||"",l.tag="",k.value=!1}),J(()=>{e.isShow?y.value=!0:setTimeout(()=>{e.isShow||(y.value=!1)},100)});function A(m){({name:w.value,code:M.value})[m].focus()}function E(){k.value=!k.value,k.value&&te(()=>{S.value.focus()})}async function N(){!l.tag||(await fe(e.projectId,e.info._id,l.tag),U.success(h("saveDone")),e.info.tags.push(l.tag),l.tag="",k.value=!1)}async function H(m,a){await he(e.projectId,e.info._id,a),U.success(h("deleteDone")),e.info.tags.splice(m,1)}async function T(m){const a={};a[m]=l[m],await _e(e.projectId,e.info._id,a),U(h("saveDone")),R("update",a)}return(m,a)=>{const O=oe("router-link");return f(),p("div",{class:"detail",ref_key:"root",ref:B},[o("div",be,[o("div",null,[I(ie,{info:u.info},null,8,["info"]),I(O,{to:`/analyse/icon/${u.projectId}/${u.info._id}`,class:"count-use c-main"},{default:G(()=>{var t;return[ce(c(d(h)("pageRefererCount"))+" "+c((t=u.info.analyse)==null?void 0:t.pageCount),1)]}),_:1},8,["to"])]),o("div",we,[o("div",$e,[o("div",xe,c(d(h)("name")),1),o("div",De,[x(o("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>l.name=t),ref_key:"nameInputDom",ref:w,onChange:a[1]||(a[1]=t=>T("name"))},null,544),[[z,l.name]]),o("i",{class:"iconfont icon-edit pointer",onClick:a[2]||(a[2]=t=>A("name"))})])]),o("div",Ce,[o("div",Be,c(d(h)("code")),1),o("div",Me,[x(o("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>l.code=t),ref_key:"codeInputDom",ref:M,onChange:a[4]||(a[4]=t=>T("code"))},null,544),[[z,l.code]]),o("i",{class:"iconfont icon-edit pointer",onClick:a[5]||(a[5]=t=>A("code"))})])]),o("div",Se,[o("div",Te,c(d(h)("group")),1),o("div",Ve,[x(o("select",{onChange:a[6]||(a[6]=t=>T("groupId")),"onUpdate:modelValue":a[7]||(a[7]=t=>l.groupId=t)},[o("option",Ge,c(d(h)("ungrouped")),1),(f(!0),p(D,null,j(u.groups,t=>(f(),p("option",{key:t._id,value:t._id},c(t.name),9,je))),128))],544),[[ee,l.groupId]])])]),o("div",Ue,[o("div",Ae,c(d(h)("tag")),1),Ee,o("i",{class:"iconfont icon-add-circle pointer",onClick:E})]),o("div",ze,[(f(!0),p(D,null,j(u.info.tags,(t,s)=>(f(),p("div",{class:"tag flex",key:t},[o("span",null,c(t),1),o("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:n=>H(s,t)},null,8,Re)]))),128)),k.value?(f(),p("div",Fe,[x(o("input",{type:"text",maxlength:"8","onUpdate:modelValue":a[8]||(a[8]=t=>l.tag=t),ref_key:"tagInputDom",ref:S},null,512),[[z,l.tag]]),o("i",{class:K(["iconfont icon-checked pointer tag-add",{active:l.tag}]),onClick:N},null,2)])):P("",!0)])])])],512)}}});const Ne=ae(Le,[["__scopeId","data-v-d3e94b0a"]]),$=u=>(se("data-v-02edd268"),u=u(),ne(),u),He={class:"name"},Oe=$(()=>o("i",{class:"iconfont icon-setting-plain"},null,-1)),We={class:"search flex center"},qe={class:"input"},Ke=$(()=>o("i",{class:"iconfont icon-search"},null,-1)),Pe=["placeholder"],Je={class:"operate flex"},Qe=$(()=>o("i",{class:"iconfont icon-plus"},null,-1)),Xe=$(()=>o("i",{class:"iconfont icon-batch"},null,-1)),Ye=$(()=>o("i",{class:"iconfont icon-code"},null,-1)),Ze={key:0,class:"operate-batch"},et=["disabled"],tt=$(()=>o("i",{class:"iconfont icon-delete"},null,-1)),ot=["disabled"],st=$(()=>o("i",{class:"iconfont icon-group-open"},null,-1)),nt=["onClick"],it=["title"],at={class:"icons"},lt=["onMouseenter","onClick"],ct={class:"name"},dt={class:"code"},ut={class:"label"},rt={value:""},pt=["value"],ft=X({__name:"Index",setup(u){const{t:r}=Y(),R=ue(),e=Z({_id:R.params.id,name:"",icons:[],groups:[],groupMap:{},list:[],detail:{info:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),h=v({});async function C(){const t=await ge(e._id,"name icons groups");e.name=t.name,t.groups instanceof Array&&(e.groups=t.groups.sort((s,n)=>n.num-s.num),t.groups.forEach(s=>{e.groupMap[s._id]=s})),t.icons instanceof Array&&(e.icons=t.icons.reverse(),t.icons.length>0&&(y(),te(N)))}function y(){const t=e.groups.map(n=>(n.icons=[],n)),s=[];e.icons.forEach(n=>{F(n)&&(n.groupId&&n.groupId in e.groupMap?e.groupMap[n.groupId].icons.push(n):s.push(n))}),s.length>0&&(t.length===0||t[0]._id?t.unshift({_id:"",name:"",num:t.length,icons:s}):t[0].icons=s),e.list=t.sort((n,i)=>i.num-n.num).filter(L)}function F(t){if(!e.keyword)return!0;const s=new RegExp(e.keyword,"i");return s.test(t.name)||s.test(t.code)}function L(t){return e.keyword?t.icons.length>0:!0}C();const B=v({}),w=v({}),M=v({});let S=0,l=0;function k(t,s){l&&clearTimeout(l);const n=s.target.getBoundingClientRect(),i=w.value.getBoundingClientRect(),_=n.top-i.top+n.height,g=n.left+S-i.right,V=n.left+(g>0?-g:0)-i.left;e.detail={info:t,top:`${_}px`,left:`${V}px`,isShow:!0}}function A(){l&&clearTimeout(l)}function E(){l=setTimeout(()=>{e.detail.isShow=!1},300)}function N(){if(typeof w.value.querySelector=="function"){const t=w.value.querySelector(".icon-item");if(t){const s=t.getBoundingClientRect().width*3/2;B.value.style.width=`${Math.floor((window.innerWidth-20)/s)*s}px`}}}re(()=>{S=M.value.root.getBoundingClientRect().width});function H(t,s){if(!!e.isBatching){if(e.selectedIcons.has(t._id)){e.selectedIcons.delete(t._id);return}else e.selectedIcons.set(t._id,t);if(s.shiftKey&&e.selectedIcons.size>1){const n=Array.from(e.selectedIcons.values()),i=n[n.length-2],_=n[n.length-1];if(i.groupId===_.groupId){const g=(e.groupMap[i.groupId]||e.list[0]).icons,V=g.findIndex(b=>b._id===i._id),W=g.findIndex(b=>b._id===_._id);if(Math.abs(V-W)>1)for(let b=Math.min(V,W)+1,le=Math.max(V,W);b<le;++b)e.selectedIcons.set(g[b]._id,g[b])}}}}function T(t){if(!e.isBatching)return;const n=t.icons.every(i=>e.selectedIcons.has(i._id))?"delete":"set";t.icons.forEach(i=>{e.selectedIcons[n](i._id,i)})}async function m(){Q(r("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const t=[];e.selectedIcons.forEach(s=>{t.push(s._id)}),await me(e._id,t),e.selectedIcons.clear(),U(r("deleteDone")),C()})}async function a(){Q(h.value,async()=>{const t=[];e.selectedIcons.forEach(s=>{t.push(s._id)}),await ve(e._id,t,e.batchGroupId),e.selectedIcons.clear(),U(r("batchGroupDone")),C()})}function O(t){Object.assign(e.detail.info,t),"groupId"in t&&y()}return pe(()=>e.keyword,()=>{y()}),(t,s)=>{const n=oe("router-link");return f(),p(D,null,[I(Ie,{back:"/home"},{default:G(()=>[o("div",He,c(e.name),1),I(n,{to:`/project/${e._id}/setting`,class:"setting flex"},{default:G(()=>[o("span",null,c(d(r)("setting")),1),Oe]),_:1},8,["to"])]),_:1}),I(ye),o("div",{class:"main",ref_key:"mainDom",ref:B},[o("div",We,[o("div",qe,[Ke,x(o("input",{type:"text",placeholder:d(r)("search"),"onUpdate:modelValue":s[0]||(s[0]=i=>e.keyword=i)},null,8,Pe),[[z,e.keyword]])])]),o("div",Je,[I(n,{to:`/icons/${e._id}/create`,class:"operate-item flex"},{default:G(()=>[o("span",null,c(d(r)("createIcons")),1),Qe]),_:1},8,["to"]),o("div",{class:"operate-item flex",onClick:s[1]||(s[1]=i=>e.isBatching=!e.isBatching)},[o("span",null,c(d(r)(e.isBatching?"cancelBatchOperation":"batchOperation")),1),Xe]),I(n,{to:`/icons/${e._id}/use`,class:"operate-item flex"},{default:G(()=>[o("span",null,c(d(r)("useCode")),1),Ye]),_:1},8,["to"])]),e.isBatching?(f(),p("div",Ze,[o("button",{class:"btn",onClick:m,disabled:e.selectedIcons.size===0},[o("span",null,c(d(r)("batchDelete")),1),tt],8,et),o("button",{class:"btn",onClick:a,disabled:e.selectedIcons.size===0},[o("span",null,c(d(r)("batchGroup")),1),st],8,ot)])):P("",!0),o("div",{class:"list",ref_key:"iconListDom",ref:w},[(f(!0),p(D,null,j(e.list,i=>(f(),p("div",{class:"group",key:i._id},[o("div",{class:K(["group-title flex",{pointer:e.isBatching}]),onClick:_=>T(i)},[o("span",null,c(i.name),1),e.isBatching?(f(),p("span",{key:0,class:"iconfont icon-select-all",title:d(r)("selectAll")},null,8,it)):P("",!0)],10,nt),o("div",at,[(f(!0),p(D,null,j(i.icons,_=>(f(),p("div",{class:K(["icon-item t-center",{selectable:e.isBatching,selected:e.selectedIcons.has(_._id)}]),key:_._id,onMouseenter:g=>k(_,g),onMouseleave:s[2]||(s[2]=g=>E()),onClick:g=>H(_,g)},[I(ie,{info:_},null,8,["info"]),o("div",ct,c(_.name),1),o("div",dt,c(_.code),1)],42,lt))),128))])]))),128)),I(Ne,{ref_key:"detailDom",ref:M,"project-id":e._id,info:e.detail.info,top:e.detail.top,left:e.detail.left,"is-show":e.detail.isShow,groups:e.groups,onUpdate:O,onMouseenter:A,onMouseleave:E},null,8,["project-id","info","top","left","is-show","groups"])],512)],512),o("div",{class:"group-select",ref_key:"batchGroupFormDom",ref:h},[o("div",ut,c(d(r)("batchSetGroup",{n:e.selectedIcons.size})),1),x(o("select",{"onUpdate:modelValue":s[3]||(s[3]=i=>e.batchGroupId=i)},[o("option",rt,c(d(r)("ungrouped")),1),(f(!0),p(D,null,j(e.groups,i=>(f(),p("option",{key:i._id,value:i._id},c(i.name),9,pt))),128))],512),[[ee,e.batchGroupId]])],512)],64)}}});const yt=ae(ft,[["__scopeId","data-v-02edd268"]]);export{yt as default};
