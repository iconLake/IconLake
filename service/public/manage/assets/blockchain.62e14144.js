var H=Object.defineProperty;var K=(a,e,t)=>e in a?H(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var R=(a,e,t)=>(K(a,typeof e!="symbol"?e+"":e,t),t);import{C as B,B as G}from"./@iconlake/client.0b258216.js";import{I as A,t as g,C as E,q as F,b as V,L as W}from"./cache.05004cf3.js";import{c as D}from"./index.9c1809da.js";import{z as J}from"./index.c3ac6b9b.js";const $=a=>typeof a=="object"&&a!==null,O=a=>$(a)&&!(a instanceof RegExp)&&!(a instanceof Error)&&!(a instanceof Date),Y=Symbol("mapObjectSkip"),_=(a,e,t,s=new WeakMap)=>{if(t={deep:!1,target:{},...t},s.has(a))return s.get(a);s.set(a,t.target);const{target:r}=t;delete t.target;const n=o=>o.map(i=>O(i)?_(i,e,t,s):i);if(Array.isArray(a))return n(a);for(const[o,i]of Object.entries(a)){const c=e(o,i,a);if(c===Y)continue;let[l,h,{shouldRecurse:p=!0}={}]=c;l!=="__proto__"&&(t.deep&&p&&O(h)&&(h=Array.isArray(h)?n(h):_(h,e,t,s)),r[l]=h)}return r};function T(a,e,t){if(!$(a))throw new TypeError(`Expected an object, got \`${a}\` (${typeof a})`);return _(a,e,t)}const Q=/[\p{Lu}]/u,X=/[\p{Ll}]/u,U=/^[\p{Lu}](?![\p{Lu}])/gu,j=/([\p{Alpha}\p{N}_]|$)/u,b=/[_.\- ]+/,Z=new RegExp("^"+b.source),N=new RegExp(b.source+j.source,"gu"),L=new RegExp("\\d+"+j.source,"gu"),ee=(a,e,t,s)=>{let r=!1,n=!1,o=!1,i=!1;for(let c=0;c<a.length;c++){const l=a[c];i=c>2?a[c-3]==="-":!0,r&&Q.test(l)?(a=a.slice(0,c)+"-"+a.slice(c),r=!1,o=n,n=!0,c++):n&&o&&X.test(l)&&(!i||s)?(a=a.slice(0,c-1)+"-"+a.slice(c-1),o=n,n=!1,r=!0):(r=e(l)===l&&t(l)!==l,o=n,n=t(l)===l&&e(l)!==l)}return a},te=(a,e)=>(U.lastIndex=0,a.replaceAll(U,t=>e(t))),ae=(a,e)=>(N.lastIndex=0,L.lastIndex=0,a.replaceAll(L,(t,s,r)=>["_","-"].includes(a.charAt(r+t.length))?t:e(t)).replaceAll(N,(t,s)=>e(s)));function se(a,e){if(!(typeof a=="string"||Array.isArray(a)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(a)?a=a.map(n=>n.trim()).filter(n=>n.length).join("-"):a=a.trim(),a.length===0)return"";const t=e.locale===!1?n=>n.toLowerCase():n=>n.toLocaleLowerCase(e.locale),s=e.locale===!1?n=>n.toUpperCase():n=>n.toLocaleUpperCase(e.locale);return a.length===1?b.test(a)?"":e.pascalCase?s(a):t(a):(a!==t(a)&&(a=ee(a,t,s,e.preserveConsecutiveUppercase)),a=a.replace(Z,""),a=e.preserveConsecutiveUppercase?te(a,t):t(a),e.pascalCase&&(a=s(a.charAt(0))+a.slice(1)),ae(a,s))}class re extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,s]of e)this.onEviction(t,s.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const s=t.get(e);return this._getItemValue(e,s)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||this._deleteIfExpired(t,s)===!1&&(yield e)}for(const e of this.cache){const[t,s]=e;this._deleteIfExpired(t,s)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:s=this.maxAge}={}){const r=typeof s=="number"&&s!==Number.POSITIVE_INFINITY?Date.now()+s:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:r}):this._set(e,{value:t,expiry:r}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],s=t.length-e;s<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(s>0&&this._emitEvictions(t.slice(0,s)),this.oldCache=new Map(t.slice(s)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,s]=e;this._deleteIfExpired(t,s)===!1&&(yield[t,s.value])}for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||this._deleteIfExpired(t,s)===!1&&(yield[t,s.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const s=e[t],[r,n]=s;this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const s=e[t],[r,n]=s;this.cache.has(r)||this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[s,r]of this.entriesAscending())e.call(t,r,s,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const ne=(a,e)=>a.some(t=>typeof t=="string"?t===e:(t.lastIndex=0,t.test(e))),C=new re({maxSize:1e5}),P=a=>typeof a=="object"&&a!==null&&!(a instanceof RegExp)&&!(a instanceof Error)&&!(a instanceof Date),z=(a,e={})=>{if(!P(a))return a;const{exclude:t,pascalCase:s=!1,stopPaths:r,deep:n=!1,preserveConsecutiveUppercase:o=!1}=e,i=new Set(r),c=l=>(h,p)=>{if(n&&P(p)){const u=l===void 0?h:`${l}.${h}`;i.has(u)||(p=T(p,c(u)))}if(!(t&&ne(t,h))){const u=s?`${h}_`:h;if(C.has(u))h=C.get(u);else{const d=se(h,{pascalCase:s,locale:!1,preserveConsecutiveUppercase:o});h.length<100&&C.set(u,d),h=d}}return[h,p]};return T(a,c(void 0))};function v(a,e){return Array.isArray(a)?Object.keys(a).map(t=>z(a[t],e)):z(a,e)}class oe{async resizeImageAndGetData(e,t,s){const n=(await this.resizeImage(e,t,s)).getContext("2d");if(!n)throw new Error("cannot get context from canvas");return n.getImageData(0,0,t,s).data}async resizeImage(e,t,s){let r=document.createElement("canvas");r.width=t,r.height=s;const n=r.getContext("2d");if(!n)throw new Error("cannot get context from canvas");return n.drawImage(e,0,0,t,s),r}}const ce=new oe;class ie{convert(e){const t=new Uint8ClampedArray(e.length/4);let s=255,r=255;for(let n=0;n<e.length;n+=4)r=e[n+3]/255,s=255*(1-r),t[n>>2]=Math.round((e[n]*r+s)*299/1e3+(e[n+1]*r+s)*587/1e3+(e[n+2]*r+s)*114/1e3);return t}}const le=new ie;class S{constructor(e){R(this,"binArray");this.binArray=e}static fromHexString(e){if(e.length%2!==0)throw Error("hex string length must be a multiple of 2");const t=new Uint8ClampedArray(e.length/2*8);let s="";for(let r=0;r<e.length;r++){const n=e[r];s+=parseInt(n,16).toString(2).padStart(4,"0")}for(let r=0;r<s.length;r++)t[r]=parseInt(s[r]);return new S(t)}toHexString(){const e=this.binArray.join("");let t="";for(let s=0;s<e.length;s+=4){const r=e.substring(s,s+4);t+=parseInt(r,2).toString(16)}return t}hammingDistance(e){if(e.binArray.length!==this.binArray.length)throw new Error("Cannot compare two ImageHash instances of different sizes");let t=0;for(let s=0;s<this.binArray.length;s++)this.binArray[s]!==e.binArray[s]&&(t+=1);return t}}const x={};function he(a){if(a in x)return x[a];const e=Math.PI/(2*a),t=new Array(a).fill(0).map(()=>new Array(a));for(let s=0;s<a;s++){const r=s*e;for(let n=0;n<a;n++)t[s][n]=Math.cos((2*n+1)*r)}return x[a]=t,t}function fe(a){const e=Math.round(Math.sqrt(a.length)),t=he(e),s=new Array(e*e);for(let r=0;r<e;r++)for(let n=0;n<e;n++){let o=0;for(let i=0;i<e;i++)for(let c=0;c<e;c++)o+=a[i*e+c]*t[r][i]*t[n][c];s[r*e+n]=o}return s}function ue(a){const e=[...a].sort((s,r)=>s-r),t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}async function de(a,e=8,t=4){const s=e*t,r=await ce.resizeImageAndGetData(a,s,s),n=le.convert(r),o=fe(n),i=new Float64Array(e*e),c=new Float64Array(e*e);let l=0,h=0;for(let d=0;d<e;d++){for(let k=0;k<e;k++)i[l]=o[h],c[l]=o[h],l+=1,h+=1;h+=s-e}const p=ue(c),u=new Uint8ClampedArray(e*e);for(let d=0;d<u.length;++d)u[d]=i[d]>p?1:0;return new S(u)}const ge="/api/blockchain/",M=A?"https://lcd.iconlake.com":"https://lcd.testnet.iconlake.com",me=A?"https://rpc.iconlake.com":"https://rpc.testnet.iconlake.com",pe="iconlake",{t:m}=J.global,we={apiURL:M,rpcURL:me,prefix:pe},f=new B(we);let q=!1;async function w(){if(q)return window.keplr;if(window.keplr){const a=E;try{await window.keplr.enable(a)}catch(t){console.error(t);const s=await fetch(`/common/chain-${A?"main":"test"}net.json`).then(r=>r.json());await window.keplr.experimentalSuggestChain(s),await new Promise(r=>{setTimeout(r,200)}),await window.keplr.enable(a)}const e=await window.keplr.getOfflineSignerAuto(a);f.useSigner(e),q=!0}else throw g("Please install keplr extension"),new Error("keplr extension not found");return window.keplr}async function ye(a,e){const t=await fetch(`${M}/cosmos/bank/v1beta1/balances/${a}?denom=${e}`).then(s=>s.json()).catch(s=>(console.error(s),{balances:[]}));return e?t.balances.find(s=>s.denom===e):t.balances}async function y(a){const s=await(await w()).getOfflineSigner(E).getAccounts().catch(r=>(console.error(r),g.error(m("cannotGetKeplrAccount")),[]));if(a){const r=s.find(n=>n.address===a);if(!r)g.error(m("activeKeplrAccountAs",{addr:a}));else return r}return s[0]}async function Ie(a){const e=await fetch(`${M}/cosmos/auth/v1beta1/accounts/${a}`).then(t=>t.json()).catch(t=>(console.error(t),{account:void 0}));return e.account&&v(e.account)}async function I({msg:a,address:e,feeDenom:t}){var o,i;const s=await Ie(e),r=await ye(e,t),n=await f.CosmosTxV1Beta1.query.serviceSimulate({tx:{body:{messages:[a]},auth_info:{signer_infos:[{public_key:{"@type":"/cosmos.crypto.secp256k1.PubKey",key:s==null?void 0:s.pubKey.value},mode_info:{single:{mode:"SIGN_MODE_DIRECT"}},sequence:s==null?void 0:s.sequence}],fee:{gas_limit:"1000000",amount:r?r instanceof Array?r:[r]:[]}},signatures:[G.from("").toString("base64")]}}).catch(c=>(console.error(c),{data:{gas_info:{gas_used:""}}}));return{gas:Math.ceil(((o=n.data.gas_info)!=null&&o.gas_used?+((i=n.data.gas_info)==null?void 0:i.gas_used):0)*1.2).toString(),data:n.data}}async function be(a,e){if(await w(),!await y(a))return;const s={creator:a,amount:{amount:e,denom:V}},r=await I({msg:{"@type":"/iconlake.drop.MsgMint",...s,amount:{...s.amount,amount:"10000"}},address:a});return await f.IconlakeDrop.tx.sendMsgMint({value:s,fee:{amount:[],gas:r.gas||"100000"}}).catch(o=>{var i;console.error(o),g.error((i=o.message)!=null?i:m("fail"))})}async function ve(a){const e=await w(),t=await y();return t?await e.signArbitrary(E,t.address,a).catch(r=>{var n;console.error(r),g.error((n=r.message)!=null?n:m("fail"))}):void 0}async function Se(a){const e=await fetch(a).then(l=>l.blob()),t=new FileReader;t.readAsDataURL(e);const s=await new Promise(l=>{t.onload=()=>{l(t.result)}}),r=new Image;r.src=s,await new Promise(l=>{r.onload=()=>{l()}});const n=await de(r),o=await e.arrayBuffer(),i=D.exports.lib.WordArray.create();i.init(o);const c=D.exports.SHA256(i);return{graphHash:`p:${n.toHexString()}`,fileHash:c.toString()}}async function Me(a){if(await w(),!await y(a.creator))return;const t=await I({msg:{"@type":"/iconlake.icon.MsgMint",...a},address:a.creator});return await f.IconlakeIcon.tx.sendMsgMint({value:a,fee:{amount:[],gas:t.gas||"100000"}}).catch(r=>{var n;console.error(r),g.error((n=r.message)!=null?n:m("fail"))})}async function ke(a){if(await w(),!await y(a.creator))return;const t=await I({msg:{"@type":"/iconlake.icon.MsgBurn",...a},address:a.creator});return await f.IconlakeIcon.tx.sendMsgBurn({value:a,fee:{amount:[],gas:t.gas||"80000"}}).catch(r=>{var n;console.error(r),g.error((n=r.message)!=null?n:m("fail"))})}async function Re(a){const e=await f.IconlakeDrop.query.queryInfo(a).catch(t=>{console.error(t)});return e==null?void 0:e.data.info}async function De(a,e,t){if(t)return F({url:"/api/blockchain/drop/init"});if(await w(),!await y(a))return;const r=await I({msg:{"@type":"/iconlake.drop.MsgInit",creator:a,address:e},address:a,feeDenom:W});return await f.IconlakeDrop.tx.sendMsgInit({value:{creator:a,address:e},fee:{amount:[],gas:r.gas||"100000"}}).catch(n=>{var o;console.error(n),g.error((o=n.message)!=null?o:m("fail"))})}async function Oe(a){const e=await f.IconlakeIcon.query.queryNFTs({owner:a.owner,class_id:a.classId}).catch(t=>(console.error(t),{data:{nfts:[]}}));return(e==null?void 0:e.data)&&v(e.data,{deep:!0})}async function Te(a){const e=await f.IconlakeIcon.query.queryClass({id:a}).catch(t=>(console.error(t),{data:void 0}));return(e==null?void 0:e.data)&&v(e.data,{deep:!0})}async function Ue(a){if(await w(),!await y(a.creator))return;const t=await I({msg:{"@type":"/iconlake.icon.MsgUpdateClass",...a},address:a.creator});return await f.IconlakeIcon.tx.sendMsgUpdateClass({value:a,fee:{amount:[],gas:t.gas||"100000"}}).catch(r=>{var n;console.error(r),g.error((n=r.message)!=null?n:m("updateFailed"))})}async function Ne(a){const e=await f.IconlakeIcon.query.queryCreator(a).catch(t=>{console.error(t)});return e==null?void 0:e.data}async function Le(a){if(await w(),!await y(a.address))return;const t=await I({msg:{"@type":"/iconlake.icon.MsgUpdateCreator",...a},address:a.address});return await f.IconlakeIcon.tx.sendMsgUpdateCreator({value:a,fee:{amount:[],gas:t.gas||"100000"}}).catch(r=>{var n;console.error(r),g.error((n=r.message)!=null?n:m("updateFailed"))})}function Pe(){return F({method:"GET",url:"/info",baseURL:ge})}export{Se as a,Oe as b,Ie as c,ke as d,be as e,Pe as f,Te as g,ye as h,De as i,Re as j,w as k,Le as l,Me as m,Ne as n,ve as s,Ue as u};
