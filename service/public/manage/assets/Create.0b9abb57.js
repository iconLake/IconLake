import{d as Y,u as q,E as W,a7 as Z,r as E,o as K,m as Q,p as X,c as r,a as F,w as ee,b as a,e as i,q as x,t as u,f as d,F as $,h as te,v as y,l as L,i as se,k as c,_ as oe}from"./index.c3ac6b9b.js";import{p as ne,n as ae,u as ie}from"./project.3e053923.js";import{H as le}from"./Header.5323aa62.js";import{U as ce}from"./User.3e9238d3.js";import{U as O,t as v,r as re,k as de,P as A,l as ue}from"./cache.05004cf3.js";import{c as T}from"./index.9c1809da.js";import{L as B}from"./Loading.7dd0339b.js";import{i as fe,a as pe}from"./file.fa12e67d.js";import{I as ge}from"./Icon.baf4c0eb.js";import"./@iconlake/client.0b258216.js";import"./extension.dbd15d4c.js";import"./user.237cd0b6.js";const me={class:"name"},ve={class:"tab flex"},he={class:"wrap"},_e=["title"],ye=["title"],be=["title"],xe=["title","onClick"],ke={key:1,class:"upload flex center"},Ie={for:"img"},Se={key:2,class:"upload flex center"},Te={for:"svg"},we={key:3,class:"upload flex center"},Ce={for:"javascript"},Fe={key:4,class:"upload flex center m-top"},Ae={key:5,class:"extension t-center"},je={class:"flex center download"},Ee={class:"item"},$e={class:"store",href:"https://chrome.google.com/webstore/detail/iconlake/lfjdnkcfpebmhjbeihnebpdalolhcmmb",target:"_blank"},Le={class:"item"},Oe={class:"store",href:"https://microsoftedge.microsoft.com/addons/detail/iconlake/ilkiempcnikelnciijanjlgmchleamjh",target:"_blank"},Be={key:6,class:"flex center"},Ue=["disabled"],Ve=Y({__name:"Create",setup(Pe){const{t:o}=q(),U=se(),V=W(),P=Z(),s=E({_id:V.params.id,type:0,name:"",activeTab:"extension",icons:[]}),j={},_=E({success:0,fail:0,total:0});async function R(){ne.info(s._id,"type name icons").onUpdate(async n=>{s.type=n.type,s.name=n.name,s.activeTab=["","svg","img"][s.type],n.icons.forEach(e=>{j[e.code]=e})})}K(()=>{R().finally(()=>{U.end()})});function k(n){return s.activeTab===n?"active":""}function I(n){s.activeTab=n,s.icons.length=0,p.clear()}let p=new Map;function b(){const n=[];p.forEach((e,t)=>{var f;if(e.prefix&&e.id&&(e.code=(f=e.id)==null?void 0:f.substring(e.prefix.length)),j[e.code])return p.delete(t),v(o("codeExistsAndIconOut",{code:e.code}));n.push(e)}),s.icons=n}function w(n,e,t,f,g){return new Promise(async(h,m)=>{if(_.total++,p.has(e)){v(o("codeExistsAndIconOut",{code:e})),m("code exists");return}else{const l=new FileReader,C=t instanceof Blob?t:new Blob([t],{type:"image/svg+xml"});l.readAsDataURL(C),l.onload=()=>{p.set(e,{code:e,name:f,[n]:{url:l.result},uploadStatus:0}),b()}}ie({projectId:s._id,_id:g||f,data:t}).then(l=>{_.success++,p.has(e)?(Object.assign(p.get(e),{[n]:{url:l.url},uploadStatus:1}),b(),h(p.get(e))):m("icon deleted")}).catch(l=>{_.fail++,console.error(l),p.has(e)&&(Object.assign(p.get(e),{uploadStatus:2}),b()),v.error(o("fileUploadFailed")),m(l)})})}function N(n){const e=n.target.files;e&&e.length>0&&Array.from(e).forEach(async t=>{if(!fe(t))return;if(!t.size||t.size>O){v(o("fileSizeLimitExceeded"));return}const f=await re(t),g=t.name.substring(0,t.name.lastIndexOf(".")),h=T.exports.SHA256(f).toString();w("svg",g,f,`${h}.svg`)})}function z(n){const e=n.target.files;e&&e.length>0&&Array.from(e).forEach(async t=>{if(!pe(t))return;if(!t.size||t.size>O){v(o("fileSizeLimitExceeded"));return}const f=await de(t),g=t.name.substring(0,t.name.lastIndexOf(".")),h=await f.arrayBuffer(),l=`${T.exports.SHA256(T.exports.lib.WordArray.create(Array.from(new Uint8Array(h)))).toString()}.${t.name.substring(t.name.lastIndexOf(".")+1)}`;w("img",l,f,g,l)})}function G(n){const e=n.target.files;if(e&&e.length>0){if(e[0].type!=="text/javascript")return v.error(o("pleaseSelectFile",{type:".js"}));const t=new FileReader;t.readAsText(e[0],"utf-8"),t.onload=()=>{const g=t.result.match(/<symbol.*?>.*?<\/symbol>/ig);g&&g.forEach(h=>{const m=h.match(/^<symbol.*?id="(.*?)".*?viewBox="(.*?)">(.*?)<\/symbol>$/i);if(m){const l=`<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" viewBox="${m[2]}">${m[3]}</svg>`;_.total++;const C=T.exports.SHA256(l).toString();w("svg",m[1],l,`${C}.svg`).then(()=>{_.success++}).catch(()=>{_.fail++})}})},t.onerror=()=>{v.error(o("fileLoadFailed"))}}}function J(n){const e=n.target.files;if(e&&e.length>0){if(e[0].type!=="application/json")return v.error(o("pleaseSelectFile",{type:".json"}));const t=new FileReader;t.readAsText(e[0],"utf-8"),t.onload=()=>{const f=t.result;try{const g=JSON.parse(f),h=g.css_prefix_text;g.glyphs instanceof Array&&(g.glyphs.forEach(m=>{const l=`${h}${m.font_class}`;p.has(l)||p.set(l,{}),Object.assign(p.get(l),{id:l,name:m.name,prefix:h})}),b())}catch{v.error(o("fileCouldNotBeParsed"))}},t.onerror=()=>{v.error(o("fileLoadFailed"))}}}async function H(n){p.delete(n.code),b()}const S=Q(!1);async function M(){if(_.success+_.fail<_.total){v.error(o("waitForUploadFinish"));return}if(S.value)return;const n=s.icons.filter(e=>e.uploadStatus===1);S.value=!0,await ae(s._id,n),v.success(o("saveDone")),P.replace(`/icons/${s._id}`),S.value=!1}const D=X(()=>s.icons.filter(n=>n.uploadStatus===1).length);return(n,e)=>(c(),r($,null,[F(le,{back:`/icons/${s._id}`},{default:ee(()=>[a("div",me,u(s.name),1)]),_:1},8,["back"]),F(ce),a("div",ve,[s.type===i(A).IMG?(c(),r("div",{key:0,class:x(["item",k("img")]),onClick:e[0]||(e[0]=t=>I("img"))},u(i(o)("uploadImg")),3)):d("",!0),s.type===i(A).SVG?(c(),r("div",{key:1,class:x(["item",k("svg")]),onClick:e[1]||(e[1]=t=>I("svg"))},u(i(o)("uploadSVG")),3)):d("",!0),s.type===i(A).SVG?(c(),r("div",{key:2,class:x(["item",k("iconfont")]),onClick:e[2]||(e[2]=t=>I("iconfont"))},u(i(o)("importIconfont")),3)):d("",!0),a("div",{class:x(["item",k("extension")]),onClick:e[3]||(e[3]=t=>I("extension"))},u(i(o)("collectIcons")),3)]),a("div",he,[s.activeTab==="svg"||s.activeTab==="img"||s.activeTab==="iconfont"?(c(),r("div",{key:0,class:x(`icons flex start type-${i(ue)[s.type]}`)},[(c(!0),r($,null,te(s.icons,t=>(c(),r("div",{key:t.code,class:"item"},[F(ge,{info:{_id:"",groupId:"",tags:[],...t}},null,8,["info"]),t.name&&t.code!==t.name?(c(),r("div",{key:0,class:"name",title:t.name},u(t.name),9,_e)):d("",!0),t.code?(c(),r("div",{key:1,class:"name",title:t.code},[y(u(t.code)+" ",1),t.uploadStatus===0?(c(),L(B,{key:0})):d("",!0),t.uploadStatus===2?(c(),r("i",{key:1,title:i(o)("fileUploadFailed"),class:"iconfont icon-warn"},null,8,be)):d("",!0),t.uploadStatus!==0?(c(),r("div",{key:2,class:"delete pointer flex center",title:i(o)("delete"),onClick:f=>H(t)},e[4]||(e[4]=[a("i",{class:"iconfont icon-delete-fill c-danger"},null,-1)]),8,xe)):d("",!0)],8,ye)):d("",!0)]))),128))],2)):d("",!0),s.activeTab==="img"?(c(),r("div",ke,[a("label",Ie,[y(u(i(o)("selectIconFile",{type:i(o)("img")}))+" ",1),a("input",{id:"img",type:"file",accept:"image/*",multiple:"",onChange:z},null,32)])])):d("",!0),s.activeTab==="svg"?(c(),r("div",Se,[a("label",Te,[y(u(i(o)("selectIconFile",{type:"SVG"}))+" ",1),a("input",{id:"svg",type:"file",accept:"image/svg+xml",multiple:"",onChange:N},null,32)])])):d("",!0),s.activeTab==="iconfont"?(c(),r("div",we,[a("label",Ce,[y(u(i(o)("selectIconFile",{type:"iconfont.js"}))+" ",1),a("input",{id:"javascript",type:"file",accept:"text/javascript",onChange:G},null,32)])])):d("",!0),s.activeTab==="iconfont"?(c(),r("div",Fe,[a("label",null,[y(u(i(o)("selectIconFile",{type:"iconfont.json"}))+" ",1),a("input",{type:"file",accept:"application/json",onChange:J},null,32)])])):d("",!0),s.activeTab==="extension"?(c(),r("div",Ae,[a("h1",null,u(i(o)("iconlakeExtension")),1),a("h2",null,u(i(o)("collectFromAnySites")),1),a("div",je,[a("div",Ee,[e[5]||(e[5]=a("h3",null,[a("img",{class:"browser",src:"/imgs/chrome.svg"})],-1)),a("p",null,[a("a",$e,u(i(o)("webStore")),1)])]),d("",!0),a("div",Le,[e[7]||(e[7]=a("h3",null,[a("img",{class:"browser",src:"/imgs/edge.svg"})],-1)),a("p",null,[a("a",Oe,u(i(o)("webStore")),1)])])])])):d("",!0),s.activeTab==="svg"||s.activeTab==="img"||s.activeTab==="iconfont"?(c(),r("div",Be,[a("button",{class:"btn danger",disabled:D.value===0,onClick:M},[y(u(i(o)("save"))+" ",1),S.value?(c(),L(B,{key:0})):d("",!0)],8,Ue)])):d("",!0)]),e[8]||(e[8]=a("div",{class:"footer"},null,-1))],64))}});const Ke=oe(Ve,[["__scopeId","data-v-b2fd3e62"]]);export{Ke as default};
