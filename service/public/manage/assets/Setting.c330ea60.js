import{d as B,u as D,m as g,E as M,p as G,o as A,I as J,c as k,a as c,e as s,b as e,w as u,l as N,f as I,J as R,t as l,F as z,i as Y,j as T,k as f,_ as q}from"./index.c3ac6b9b.js";import{U as K}from"./User.3e9238d3.js";import{H as Q}from"./Header.5323aa62.js";import{p as W}from"./project.3e053923.js";import{g as X,a as Z,u as ee}from"./blockchain.62e14144.js";import{L as te}from"./Loading.7dd0339b.js";import{P as U,t as y,O as se}from"./cache.05004cf3.js";import{e as C}from"./event.47491da9.js";import{u as ae}from"./user.237cd0b6.js";import{u as oe}from"./ticket.d2ccb1ce.js";import"./@iconlake/client.0b258216.js";import"./extension.dbd15d4c.js";import"./index.9c1809da.js";const ne={class:"flex start main"},ie={class:"menu"},le={class:"content grow"},ce=["href"],re={class:"grow"},ue={class:"flex"},de={class:"title"},fe={key:0,class:"iconfont icon-edit"},me={class:"desc"},pe={key:1},ve=B({__name:"Setting",setup(_e){const{t:o}=D(),L=Y(),{userInfo:p}=ae(),{passkey:j,setTicketPasskey:S,getTicket:V}=oe(),v=g(),w=M(),d=w.params.id,n=g({type:U.IMG,name:"",desc:"",cover:"",class:""}),F=G(()=>/\/info$/i.test(w.path)),_=g(!1),h=g(!1);async function P(){await W.info(d,"type name desc cover class").onUpdate(async a=>{n.value=a}),H()}async function H(){const a=await X(d).catch(()=>{});h.value=!a||!a.class||a.class.name!==n.value.name||a.class.description!==n.value.desc||a.class.symbol!==n.value.class||a.class.uri!==n.value.cover}async function O(a){var m,b,$,E;a.preventDefault();const t=n.value.cover;if(!t){y(o("setCoverFirst"));return}if(_.value)return;_.value=!0;const i=await Z(t);if(!i||!((m=p==null?void 0:p.blockchain)!=null&&m.id)){y.error(o("fail"));return}const r=await ee({creator:(b=p.blockchain)==null?void 0:b.id,id:d,name:n.value.name,description:n.value.desc,symbol:n.value.class,uri:t,uriHash:($=i.fileHash)!=null?$:""});r&&((r==null?void 0:r.code)===0?(y(o("updateCompleted")),h.value=!1):y((E=r==null?void 0:r.rawLog)!=null?E:o("updateFailed"))),_.value=!1}const x=a=>{a.id===d&&P()};return A(()=>{P().finally(()=>{L.end()}),V({projectId:d},async a=>{v.value=a}),C.on(C.EventType.ProjectInfoChange,x)}),J(()=>{C.off(C.EventType.ProjectInfoChange,x)}),(a,t)=>{var m;const i=T("router-link"),r=T("router-view");return f(),k(z,null,[c(Q,{back:`/icons/${s(d)}`},null,8,["back"]),c(K),e("div",ne,[e("div",ie,[c(i,{class:"item","active-class":"active",to:"./info"},{default:u(()=>[t[1]||(t[1]=e("i",{class:"iconfont icon-info"},null,-1)),e("span",null,l(s(o)("projectInfo")),1)]),_:1,__:[1]}),c(i,{class:"item","active-class":"active",to:"./group"},{default:u(()=>[t[2]||(t[2]=e("i",{class:"iconfont icon-group"},null,-1)),e("span",null,l(s(o)("iconGroup")),1)]),_:1,__:[2]}),c(i,{class:"item","active-class":"active",to:"./member"},{default:u(()=>[t[3]||(t[3]=e("i",{class:"iconfont icon-member"},null,-1)),e("span",null,l(s(o)("projectMember")),1)]),_:1,__:[3]}),c(i,{class:"item","active-class":"active",to:"./theme"},{default:u(()=>[t[4]||(t[4]=e("i",{class:"iconfont icon-theme"},null,-1)),e("span",null,l(s(o)("theme")),1)]),_:1,__:[4]}),c(i,{class:"item","active-class":"active",to:"./ticket"},{default:u(()=>[t[5]||(t[5]=e("i",{class:"iconfont icon-ticket"},null,-1)),e("span",null,l(s(o)("ticket")),1)]),_:1,__:[5]}),c(i,{class:"item","active-class":"active",to:"./storage"},{default:u(()=>[t[6]||(t[6]=e("i",{class:"iconfont icon-storage"},null,-1)),e("span",null,l(s(o)("storage")),1)]),_:1,__:[6]}),n.value.type===s(U).SVG?(f(),N(i,{key:0,class:"item","active-class":"active",to:"./monitor"},{default:u(()=>[t[7]||(t[7]=e("i",{class:"iconfont icon-monitor"},null,-1)),e("span",null,l(s(o)("monitor")),1)]),_:1,__:[7]})):I("",!0),c(i,{class:"item","active-class":"active",to:"./advance"},{default:u(()=>[t[8]||(t[8]=e("i",{class:"iconfont icon-setting"},null,-1)),e("span",null,l(s(o)("advance")),1)]),_:1,__:[8]})]),e("div",le,[e("a",{href:`${s(se)}/exhibition/${s(d)}?ticket=${(m=v.value)==null?void 0:m._id}&passkey=${s(j)}`,target:"_blank",class:"flex info",style:R({"background-image":`url(${n.value.cover})`}),onClick:t[0]||(t[0]=b=>v.value&&s(S)({_id:v.value._id,passkey:s(j)}))},[e("div",re,[e("div",ue,[e("div",de,l(n.value.name),1),F.value?I("",!0):(f(),k("i",fe))]),e("div",me,l(n.value.desc),1)]),h.value?(f(),k("div",{key:0,class:"btn update-chain",onClick:O},[_.value?(f(),N(te,{key:0})):(f(),k("span",pe,l(s(o)("UpdateOnchainInformation")),1))])):I("",!0)],12,ce),c(r)])]),t[9]||(t[9]=e("div",{class:"footer"},null,-1))],64)}}});const Ne=q(ve,[["__scopeId","data-v-4557c527"]]);export{Ne as default};
