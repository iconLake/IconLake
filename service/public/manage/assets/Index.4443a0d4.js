import{d as X,u as Y,v as q,n as v,r as Z,G as J,c as p,b as o,a as y,w as j,t as l,e as d,y as D,z as R,H as ee,F as C,g as U,s as K,f as P,I as te,h as oe,o as f,D as le,p as ne,j as se,J as de,B as ue,K as re,L as pe}from"./index.36adfcd8.js";import{n as fe,t as B,o as _e,p as me,i as he,b as Q,r as ge,s as ve}from"./project.56d81f18.js";import{I as ie}from"./Icon.de192f19.js";import{_ as ae}from"./_plugin-vue_export-helper.cdc0426e.js";import{H as Ie}from"./Header.aab34534.js";import{U as ye}from"./User.a5dcb236.js";const ke=u=>(ne("data-v-79a1a802"),u=u(),se(),u),we={class:"flex start"},be={class:"info grow"},$e={class:"item"},xe={class:"label"},De={class:"value"},Ce={class:"item"},Be={class:"label"},Me={class:"value"},Se={class:"item info-group"},Te={class:"label"},Ve={class:"value"},Ge={value:""},Ee=["value"],je={class:"item info-tag"},Ue={class:"label"},Ae=ke(()=>o("div",{class:"value"},null,-1)),ze={class:"tags flex start"},Re=["onClick"],Fe={key:0,class:"tag flex"},Le=X({__name:"Detail",props:{projectId:null,info:null,top:null,left:null,isShow:{type:Boolean},groups:null,icons:null},emits:["update"],setup(u,{expose:r,emit:F}){const e=u;de(g=>({"47a6b8e7":d(L),a5a6ca96:d(N),"5f2db52c":d(M)}));const{t:_}=Y(),M=q(()=>e.isShow?1:0),k=v(!1),L=q(()=>k.value?e.top:"-50rem"),N=q(()=>k.value?e.left:"-50rem"),x=v(document.body),I=v(document.createElement("input")),S=v(document.createElement("input")),T=v(document.createElement("input")),c=Z({name:"",code:"",groupId:"",tag:""}),w=v(!1);r({root:x}),J(()=>{c.name=e.info.name,c.code=e.info.code,c.groupId=e.info.groupId||"",c.tag="",w.value=!1}),J(()=>{e.isShow?k.value=!0:setTimeout(()=>{e.isShow||(k.value=!1)},100)});function A(g){({name:I.value,code:S.value})[g].focus()}function z(){w.value=!w.value,w.value&&te(()=>{T.value.focus()})}async function H(){!c.tag||(await fe(e.projectId,e.info._id,c.tag),B.success(_("saveDone")),e.info.tags.push(c.tag),c.tag="",w.value=!1)}async function O(g,a){await me(e.projectId,e.info._id,a),B.success(_("deleteDone")),e.info.tags.splice(g,1)}async function V(g){const a={};if(g==="code"&&e.icons.some(G=>G.code===c.code))return B(_("codeExists"));a[g]=c[g],await _e(e.projectId,e.info._id,a),B(_("saveDone")),F("update",a)}return(g,a)=>{const G=oe("router-link");return f(),p("div",{class:"detail",ref_key:"root",ref:x},[o("div",we,[o("div",null,[y(ie,{info:u.info},null,8,["info"]),y(G,{to:`/analyse/icon/${u.projectId}/${u.info._id}`,class:"count-use c-main"},{default:j(()=>{var t;return[le(l(d(_)("pageRefererCount"))+" "+l((t=u.info.analyse)==null?void 0:t.pageCount),1)]}),_:1},8,["to"])]),o("div",be,[o("div",$e,[o("div",xe,l(d(_)("name")),1),o("div",De,[D(o("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>c.name=t),ref_key:"nameInputDom",ref:I,onChange:a[1]||(a[1]=t=>V("name"))},null,544),[[R,c.name]]),o("i",{class:"iconfont icon-edit pointer",onClick:a[2]||(a[2]=t=>A("name"))})])]),o("div",Ce,[o("div",Be,l(d(_)("code")),1),o("div",Me,[D(o("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>c.code=t),ref_key:"codeInputDom",ref:S,onChange:a[4]||(a[4]=t=>V("code"))},null,544),[[R,c.code]]),o("i",{class:"iconfont icon-edit pointer",onClick:a[5]||(a[5]=t=>A("code"))})])]),o("div",Se,[o("div",Te,l(d(_)("group")),1),o("div",Ve,[D(o("select",{onChange:a[6]||(a[6]=t=>V("groupId")),"onUpdate:modelValue":a[7]||(a[7]=t=>c.groupId=t)},[o("option",Ge,l(d(_)("ungrouped")),1),(f(!0),p(C,null,U(u.groups,t=>(f(),p("option",{key:t._id,value:t._id},l(t.name),9,Ee))),128))],544),[[ee,c.groupId]])])]),o("div",je,[o("div",Ue,l(d(_)("tag")),1),Ae,o("i",{class:"iconfont icon-add-circle pointer",onClick:z})]),o("div",ze,[(f(!0),p(C,null,U(u.info.tags,(t,n)=>(f(),p("div",{class:"tag flex",key:t},[o("span",null,l(t),1),o("i",{class:"iconfont icon-delete-fill pointer tag-del",onClick:s=>O(n,t)},null,8,Re)]))),128)),w.value?(f(),p("div",Fe,[D(o("input",{type:"text",maxlength:"8","onUpdate:modelValue":a[8]||(a[8]=t=>c.tag=t),ref_key:"tagInputDom",ref:T},null,512),[[R,c.tag]]),o("i",{class:K(["iconfont icon-checked pointer tag-add",{active:c.tag}]),onClick:H},null,2)])):P("",!0)])])])],512)}}});const Ne=ae(Le,[["__scopeId","data-v-79a1a802"]]),$=u=>(ne("data-v-6021ec90"),u=u(),se(),u),He={class:"name"},Oe=$(()=>o("i",{class:"iconfont icon-setting-plain"},null,-1)),We={class:"search flex center"},qe={class:"input"},Ke=$(()=>o("i",{class:"iconfont icon-search"},null,-1)),Pe=["placeholder"],Je={class:"operate flex"},Qe=$(()=>o("i",{class:"iconfont icon-plus"},null,-1)),Xe=$(()=>o("i",{class:"iconfont icon-batch"},null,-1)),Ye=$(()=>o("i",{class:"iconfont icon-code"},null,-1)),Ze={key:0,class:"operate-batch"},et=["disabled"],tt=$(()=>o("i",{class:"iconfont icon-delete"},null,-1)),ot=["disabled"],nt=$(()=>o("i",{class:"iconfont icon-group-open"},null,-1)),st=["onClick"],it=["title"],at={class:"icons"},ct=["onMouseenter","onClick"],lt={class:"name"},dt={class:"code"},ut={class:"label"},rt={value:""},pt=["value"],ft=X({__name:"Index",setup(u){const{t:r}=Y(),F=ue(),e=Z({_id:F.params.id,name:"",icons:[],groups:[],groupMap:{},list:[],detail:{info:{},top:"-50rem",left:"-50rem",isShow:!1},isBatching:!1,selectedIcons:new Map,keyword:"",batchGroupId:""}),_=v();async function M(){const t=await he(e._id,"name icons groups");e.name=t.name,t.groups instanceof Array&&(e.groups=t.groups.sort((n,s)=>s.num-n.num),t.groups.forEach(n=>{e.groupMap[n._id]=n})),t.icons instanceof Array&&(e.icons=t.icons.reverse(),t.icons.length>0&&(k(),te(H)))}function k(){const t=e.groups.map(s=>(s.icons=[],s)),n=[];e.icons.forEach(s=>{L(s)&&(s.groupId&&s.groupId in e.groupMap?e.groupMap[s.groupId].icons.push(s):n.push(s))}),n.length>0&&(t.length===0||t[0]._id?t.unshift({_id:"",name:"",num:t.length,icons:n}):t[0].icons=n),e.list=t.sort((s,i)=>i.num-s.num).filter(N)}function L(t){if(!e.keyword)return!0;const n=new RegExp(e.keyword,"i");return n.test(t.name)||n.test(t.code)}function N(t){return e.keyword?t.icons.length>0:!0}M();const x=v(),I=v(),S=v();let T=0,c=0;function w(t,n){if(!I.value)return;c&&clearTimeout(c);const s=n.target.getBoundingClientRect(),i=I.value.getBoundingClientRect(),m=s.top-i.top+s.height,h=s.left+T-i.right,E=s.left+(h>0?-h:0)-i.left;e.detail={info:t,top:`${m}px`,left:`${E}px`,isShow:!0}}function A(){c&&clearTimeout(c)}function z(){c=setTimeout(()=>{e.detail.isShow=!1},300)}function H(){if(!(!I.value||!x.value)&&typeof I.value.querySelector=="function"){const t=I.value.querySelector(".icon-item");if(t){const n=t.getBoundingClientRect().width*3/2;x.value.style.width=`${Math.floor((window.innerWidth-20)/n)*n}px`}}}re(()=>{var t;T=((t=S.value)==null?void 0:t.root.getBoundingClientRect().width)||200});function O(t,n){if(!!e.isBatching){if(e.selectedIcons.has(t._id)){e.selectedIcons.delete(t._id);return}else e.selectedIcons.set(t._id,t);if(n.shiftKey&&e.selectedIcons.size>1){const s=Array.from(e.selectedIcons.values()),i=s[s.length-2],m=s[s.length-1];if(i.groupId===m.groupId){const h=(e.groupMap[i.groupId]||e.list[0]).icons,E=h.findIndex(b=>b._id===i._id),W=h.findIndex(b=>b._id===m._id);if(Math.abs(E-W)>1)for(let b=Math.min(E,W)+1,ce=Math.max(E,W);b<ce;++b)e.selectedIcons.set(h[b]._id,h[b])}}}}function V(t){if(!e.isBatching)return;const s=t.icons.every(i=>e.selectedIcons.has(i._id))?"delete":"set";t.icons.forEach(i=>{e.selectedIcons[s](i._id,i)})}async function g(){Q(r("batchDeleteConfirm",{n:e.selectedIcons.size}),async()=>{const t=[];e.selectedIcons.forEach(n=>{t.push(n._id)}),await ge(e._id,t),e.selectedIcons.clear(),B(r("deleteDone")),M()})}async function a(){!_.value||Q(_.value,async()=>{const t=[];e.selectedIcons.forEach(n=>{t.push(n._id)}),await ve(e._id,t,e.batchGroupId),e.selectedIcons.clear(),B(r("batchGroupDone")),M()})}function G(t){Object.assign(e.detail.info,t),"groupId"in t&&k()}return pe(()=>e.keyword,()=>{k()}),(t,n)=>{const s=oe("router-link");return f(),p(C,null,[y(Ie,{back:"/home"},{default:j(()=>[o("div",He,l(e.name),1),y(s,{to:`/project/${e._id}/setting`,class:"setting flex"},{default:j(()=>[o("span",null,l(d(r)("setting")),1),Oe]),_:1},8,["to"])]),_:1}),y(ye),o("div",{class:"main",ref_key:"mainDom",ref:x},[o("div",We,[o("div",qe,[Ke,D(o("input",{type:"text",placeholder:d(r)("search"),"onUpdate:modelValue":n[0]||(n[0]=i=>e.keyword=i)},null,8,Pe),[[R,e.keyword]])])]),o("div",Je,[y(s,{to:`/icons/${e._id}/create`,class:"operate-item flex"},{default:j(()=>[o("span",null,l(d(r)("createIcons")),1),Qe]),_:1},8,["to"]),o("div",{class:"operate-item flex",onClick:n[1]||(n[1]=i=>e.isBatching=!e.isBatching)},[o("span",null,l(d(r)(e.isBatching?"cancelBatchOperation":"batchOperation")),1),Xe]),y(s,{to:`/icons/${e._id}/use`,class:"operate-item flex"},{default:j(()=>[o("span",null,l(d(r)("useCode")),1),Ye]),_:1},8,["to"])]),e.isBatching?(f(),p("div",Ze,[o("button",{class:"btn",onClick:g,disabled:e.selectedIcons.size===0},[o("span",null,l(d(r)("batchDelete")),1),tt],8,et),o("button",{class:"btn",onClick:a,disabled:e.selectedIcons.size===0},[o("span",null,l(d(r)("batchGroup")),1),nt],8,ot)])):P("",!0),o("div",{class:"list",ref_key:"iconListDom",ref:I},[(f(!0),p(C,null,U(e.list,i=>(f(),p("div",{class:"group",key:i._id},[o("div",{class:K(["group-title flex",{pointer:e.isBatching}]),onClick:m=>V(i)},[o("span",null,l(i.name),1),e.isBatching?(f(),p("span",{key:0,class:"iconfont icon-select-all",title:d(r)("selectAll")},null,8,it)):P("",!0)],10,st),o("div",at,[(f(!0),p(C,null,U(i.icons,m=>(f(),p("div",{class:K(["icon-item t-center",{selectable:e.isBatching,selected:e.selectedIcons.has(m._id)}]),key:m._id,onMouseenter:h=>w(m,h),onMouseleave:n[2]||(n[2]=h=>z()),onClick:h=>O(m,h)},[y(ie,{info:m},null,8,["info"]),o("div",lt,l(m.name),1),o("div",dt,l(m.code),1)],42,ct))),128))])]))),128)),y(Ne,{ref_key:"detailDom",ref:S,"project-id":e._id,info:e.detail.info,top:e.detail.top,left:e.detail.left,"is-show":e.detail.isShow,groups:e.groups,icons:e.icons,onUpdate:G,onMouseenter:A,onMouseleave:z},null,8,["project-id","info","top","left","is-show","groups","icons"])],512)],512),o("div",{class:"group-select",ref_key:"batchGroupFormDom",ref:_},[o("div",ut,l(d(r)("batchSetGroup",{n:e.selectedIcons.size})),1),D(o("select",{"onUpdate:modelValue":n[3]||(n[3]=i=>e.batchGroupId=i)},[o("option",rt,l(d(r)("ungrouped")),1),(f(!0),p(C,null,U(e.groups,i=>(f(),p("option",{key:i._id,value:i._id},l(i.name),9,pt))),128))],512),[[ee,e.batchGroupId]])],512)],64)}}});const yt=ae(ft,[["__scopeId","data-v-6021ec90"]]);export{yt as default};
