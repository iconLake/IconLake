import{d as N,u as L,B as O,E as H,r as M,c as f,a as I,w as R,b as a,s as j,t as p,e as m,F as T,g as D,D as y,f as g,o as u,p as G,j as J}from"./index.5a3a44dd.js";import{i as P,t as v,v as U}from"./project.ca21b2b1.js";import{H as z}from"./Header.fd977799.js";import{U as q}from"./User.50941650.js";import{_ as K}from"./_plugin-vue_export-helper.cdc0426e.js";const Q=h=>(G("data-v-02186de2"),h=h(),J(),h),W={class:"name"},X={class:"tab flex"},Y={class:"wrap"},Z={class:"icons flex start"},ee=["viewBox","innerHTML"],te=["title"],se=["title"],oe={key:0,class:"upload flex center"},ne={for:"svg"},ae={key:1,class:"upload flex center"},ce={for:"javascript"},ie={key:2,class:"upload flex center m-top"},re={class:"flex center"},le=["disabled"],de=Q(()=>a("div",{class:"footer"},null,-1)),fe=N({__name:"Create",setup(h){const{t:n}=L(),F=O(),k=H(),s=M({_id:F.params.id,name:"",activeTab:"svg",icons:[]}),b={};async function B(){const o=await P(s._id,"name icons");s.name=o.name,o.icons.forEach(e=>{b[e.code]=e})}B();function C(o){return s.activeTab===o?"active":""}function w(o){s.activeTab=o,s.icons.length=0,l.clear()}let l=new Map;function x(){const o=[];l.forEach((e,t)=>{var c;if(e.prefix&&e.id&&(e.code=(c=e.id)==null?void 0:c.substring(e.prefix.length)),b[e.code])return l.delete(t),v(n("codeExistsAndIconOut",{code:e.code}));o.push(e)}),s.icons=o}function S(o){const e=o.target.files;e&&e.length>0&&Array.from(e).forEach(t=>{if(t.type!=="image/svg+xml")return;const c=new FileReader;c.readAsText(t,"utf-8"),c.onload=()=>{try{const _=new DOMParser().parseFromString(c.result,"image/svg+xml"),r=t.name.substring(0,t.name.lastIndexOf(".")),d={code:r,name:r,svg:{viewBox:_.documentElement.getAttribute("viewBox")||"",path:Array.from(_.documentElement.children).map($=>$.outerHTML).join("")}};l.set(r,d),x()}catch(i){console.error(i),v.error(n("fileCouldNotBeParsed"))}},c.onerror=()=>{v.error(n("fileLoadFailed"))}})}function E(o){const e=o.target.files;if(e&&e.length>0){if(e[0].type!=="text/javascript")return v.error(n("pleaseSelectFile",{type:".js"}));const t=new FileReader;t.readAsText(e[0],"utf-8"),t.onload=()=>{const i=t.result.match(/<symbol.*?>.*?<\/symbol>/ig);i&&(i.forEach(_=>{const r=_.match(/^<symbol.*?id="(.*?)".*?viewBox="(.*?)">(.*?)<\/symbol>$/i);if(r){const d={id:r[1],code:r[1],svg:{viewBox:r[2],path:r[3]}};l.has(d.id)||l.set(d.id,{}),Object.assign(l.get(d.id),d)}}),x())},t.onerror=()=>{v.error(n("fileLoadFailed"))}}}function A(o){const e=o.target.files;if(e&&e.length>0){if(e[0].type!=="application/json")return v.error(n("pleaseSelectFile",{type:".json"}));const t=new FileReader;t.readAsText(e[0],"utf-8"),t.onload=()=>{const c=t.result;try{const i=JSON.parse(c),_=i.css_prefix_text;i.glyphs instanceof Array&&(i.glyphs.forEach(r=>{const d=`${_}${r.font_class}`;l.has(d)||l.set(d,{}),Object.assign(l.get(d),{name:r.name,prefix:_})}),x())}catch{v.error(n("fileCouldNotBeParsed"))}},t.onerror=()=>{v.error(n("fileLoadFailed"))}}}async function V(){await U(s._id,s.icons),v.success(n("saveDone")),k.replace(`/icons/${s._id}`)}return(o,e)=>(u(),f(T,null,[I(z,{back:`/icons/${s._id}`},{default:R(()=>[a("div",W,p(s.name),1)]),_:1},8,["back"]),I(q),a("div",X,[a("div",{class:j(["item",C("svg")]),onClick:e[0]||(e[0]=t=>w("svg"))},p(m(n)("uploadSVG")),3),a("div",{class:j(["item",C("iconfont")]),onClick:e[1]||(e[1]=t=>w("iconfont"))},p(m(n)("importIconfont")),3)]),a("div",Y,[a("div",Z,[(u(!0),f(T,null,D(s.icons,t=>{var c,i;return u(),f("div",{key:t.code,class:"item"},[(u(),f("svg",{viewBox:(c=t.svg)==null?void 0:c.viewBox,innerHTML:(i=t.svg)==null?void 0:i.path},null,8,ee)),t.code?(u(),f("div",{key:0,class:"name",title:t.code},p(t.code),9,te)):g("",!0),t.name&&t.code!==t.name?(u(),f("div",{key:1,class:"name",title:t.name},p(t.name),9,se)):g("",!0)])}),128))]),s.activeTab==="svg"?(u(),f("div",oe,[a("label",ne,[y(p(m(n)("selectIconFile",{type:"SVG"}))+" ",1),a("input",{id:"svg",type:"file",onChange:S,accept:"image/svg+xml",multiple:""},null,32)])])):g("",!0),s.activeTab==="iconfont"?(u(),f("div",ae,[a("label",ce,[y(p(m(n)("selectIconFile",{type:"iconfont.js"}))+" ",1),a("input",{id:"javascript",type:"file",onChange:E,accept:"text/javascript"},null,32)])])):g("",!0),s.activeTab==="iconfont"?(u(),f("div",ie,[a("label",null,[y(p(m(n)("selectIconFile",{type:"iconfont.json"}))+" ",1),a("input",{type:"file",onChange:A,accept:"application/json"},null,32)])])):g("",!0),a("div",re,[a("button",{class:"btn danger",disabled:s.icons.length===0,onClick:V},p(m(n)("save")),9,le)])]),de],64))}});const ge=K(fe,[["__scopeId","data-v-02186de2"]]);export{ge as default};
