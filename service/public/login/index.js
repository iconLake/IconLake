var __awaiter=this&&this.__awaiter||function(e,r,c,d){return new(c=c||Promise)(function(i,t){function n(e){try{a(d.next(e))}catch(e){t(e)}}function o(e){try{a(d.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?i(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}a((d=d.apply(e,r||[])).next())})};__awaiter(this,void 0,void 0,function*(){location.search&&URL&&(i=new URL(location.href).searchParams.get("referer"))&&(document.cookie=`referer=${i};path=/`);const e=yield fetch("/api/login/params").then(e=>e.json()),t=encodeURIComponent(location.origin);var i=document.querySelector(".auth .gitee"),i=(e.login.gitee?(i.classList.add("active"),i.addEventListener("click",()=>{location.href=`https://gitee.com/oauth/authorize?client_id=${e.clientId.gitee}&redirect_uri=${t}%2Fapi%2Foauth%2Fgitee&response_type=code`})):i.style.display="none",document.querySelector(".auth .github")),i=(e.login.github?(i.classList.add("active"),i.addEventListener("click",()=>{location.href=`https://github.com/login/oauth/authorize?client_id=${e.clientId.github}&redirect_uri=${t}%2Fapi%2Foauth%2Fgithub`})):i.style.display="none",document.querySelector(".auth .code")),n=(e.login.code?(i.classList.add("active"),i.addEventListener("click",()=>{var e=prompt("请填写Code：");e&&(location.href="/api/oauth/code?id="+e)})):i.style.display="none",document.querySelector(".auth .keplr"));e.login.keplr?(n.classList.add("active"),n.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){var e,t,i,n;"keplr"in window?(yield(n=window.keplr).enable(e="iconlake"),t=yield n.getOfflineSigner(e).getAccounts(),i=`Login iconLake
${(new Date).toISOString()}
`+t[0].address,n=yield n.signArbitrary(e,t[0].address,i),fetch("/api/oauth/blockchain",{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({msg:i,sig:n.signature,pubkey:n.pub_key})}).then(e=>e.json()).then(e=>{e.error?alert(e.error):window.location.href=e.redirect})):alert("请安装Keplr浏览器插件")}))):i.style.display="none"});
